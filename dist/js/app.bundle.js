/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{"use strict";var e,t={238:(e,t,n)=>{var r=function(e){if(!e)return"Tanggal tidak diketahui";try{var t=new Date(e);return isNaN(t.getTime())?"Tanggal tidak valid":t.toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(e){return console.error("Error formatting date:",e),"Tanggal tidak diketahui"}},o=function(e){return console.log("üîç Template: Creating story item for:",e),'\n    <div class="story-item">\n      <img class="story-item__header__poster" \n           src="'.concat(e.image||"https://placehold.co/400x300/333/ffffff/png?text=No+Image",'" \n           alt="').concat(e.title||"Untitled Story",'" \n           onerror="this.src=\'https://placehold.co/400x300/333/ffffff/png?text=No+Image\'; this.alt=\'No Image Available\';">\n      <div class="story-item__content">\n        <h3 class="story-item__title">\n          <a href="#/detail/').concat(e.id,'">').concat(e.title||"Untitled Story",'</a>\n        </h3>\n        <p class="story-item__description">').concat((e.description||"No description available").substring(0,100),'...</p>\n        <p class="story-item__date">\n          <i class="fas fa-calendar-alt"></i> ').concat(r(e.date),'\n          <br>\n          <i class="fas fa-map-marker-alt"></i> ').concat(e.location||"Lokasi tidak diketahui",'\n          <br>\n          <i class="fas fa-user"></i> ').concat(e.author||"Anonim",'\n        </p>\n        <div class="story-item__actions">\n          <a href="#/detail/').concat(e.id,'" class="btn-detail">Lihat Selengkapnya <i class="fas fa-arrow-right"></i></a>\n        </div>\n      </div>\n    </div>\n  ')},a=function(e){return console.log("üîç Template: Creating story detail for:",e),'\n    <div class="story-detail">\n      <h2 class="story__title">'.concat(e.title||"Untitled Story",'</h2>\n      <img class="story__poster" \n           src="').concat(e.image||"https://placehold.co/600x400/333/ffffff/png?text=No+Image",'" \n           alt="').concat(e.title||"Untitled Story",'" \n           onerror="this.src=\'https://placehold.co/600x400/333/ffffff/png?text=No+Image\'; this.alt=\'No Image Available\';">\n      <div class="story__info">\n        <p class="story__date"><i class="fas fa-calendar-alt"></i> Tanggal: ').concat(r(e.date),'</p>\n        <p class="story__location"><i class="fas fa-map-marker-alt"></i> Lokasi: ').concat(e.location||"Tidak diketahui",'</p>\n        <p class="story__author"><i class="fas fa-user"></i> Penulis: ').concat(e.author||"Anonim",'</p>\n      </div>\n      <p class="story__overview">').concat(e.content||e.description||"No content available",'</p>\n    </div>\n    <div class="action-buttons mt-4 flex justify-center gap-4">\n      <button id="saveStoryBtn" class="btn-primary"><i class="fas fa-bookmark"></i> Simpan Story</button>\n      <button id="tryNotificationBtn" class="btn-primary"><i class="fas fa-bell"></i> Coba Notifikasi</button>\n      <button id="backToListBtn" class="btn-secondary"><i class="fas fa-arrow-left"></i> Kembali</button>\n    </div>\n  ')},i=function(e){return console.log("üîç Template: Creating saved story item for:",e),'\n    <div class="story-item">\n      <img class="story-item__header__poster" \n           src="'.concat(e.image||"https://placehold.co/400x300/333/ffffff/png?text=No+Image",'" \n           alt="').concat(e.title||"Untitled Story",'" \n           onerror="this.src=\'https://placehold.co/400x300/333/ffffff/png?text=No+Image\'; this.alt=\'No Image Available\';">\n      <div class="story-item__content">\n        <h3 class="story-item__title">\n          <a href="#/detail/').concat(e.id,'">').concat(e.title||"Untitled Story",'</a>\n        </h3>\n        <p class="story-item__description">').concat((e.description||"No description available").substring(0,100),'...</p>\n        <p class="story-item__date">\n          <i class="fas fa-calendar-alt"></i> ').concat(r(e.date),'\n          <br>\n          <i class="fas fa-map-marker-alt"></i> ').concat(e.location||"Lokasi tidak diketahui",'\n          <br>\n          <i class="fas fa-user"></i> ').concat(e.author||"Anonim",'\n        </p>\n        <div class="story-item__actions">\n          <a href="#/detail/').concat(e.id,'" class="btn-detail">Lihat Detail <i class="fas fa-arrow-right"></i></a>\n          <button class="btn-delete" data-id="').concat(e.id,'"><i class="fas fa-trash"></i> Hapus</button>\n        </div>\n      </div>\n    </div>\n  ')};function s(){return localStorage.getItem("token")}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return l(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function f(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(l(t={},r,(function(){return this})),t),p=f.prototype=s.prototype=Object.create(d);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=f,l(p,"constructor",f),l(f,"constructor",c),c.displayName="GeneratorFunction",l(f,o,"GeneratorFunction"),l(p),l(p,o,"Generator"),l(p,r,(function(){return this})),l(p,"toString",(function(){return"[object Generator]"})),(u=function(){return{w:a,m:h}})()}function l(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){l(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},l(e,t,n,r)}function f(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){f(a,r,o,i,s,"next",e)}function s(e){f(a,r,o,i,s,"throw",e)}i(void 0)}))}}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}function h(e){var t=function(e){if("object"!=c(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:t+""}const v=function(){return e=function e(t){var n=t.view,r=t.storyRepository;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._view=n,this._storyRepository=r,this._stories=[]},t=[{key:"init",value:(r=d(u().m((function e(){return u().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,this._showStories();case 1:return e.a(2)}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_showStories",value:(n=d(u().m((function e(){var t,n;return u().w((function(e){for(;;)switch(e.n){case 0:if(e.p=0,this._view.showLoading(),s()){e.n=1;break}return this._view.showLoginError(),this._view.hideLoading(),e.a(2);case 1:return console.log("üîç DEBUG: Fetching stories..."),e.n=2,this._storyRepository.getStories();case 2:this._stories=e.v,console.log("üîç DEBUG: Raw stories from repository:",this._stories),console.log("üîç DEBUG: Stories length:",this._stories.length),this._stories.length>0&&(console.log("üîç DEBUG: First story structure:",this._stories[0]),console.log("üîç DEBUG: First story keys:",Object.keys(this._stories[0]))),0===this._stories.length?this._view.showEmptyStories():(this._view.showStories(this._stories),t=this._stories.filter((function(e){return e.latitude&&e.longitude})),console.log("üîç DEBUG: Stories with location:",t.length),t.length>0&&this._view.renderMap(t)),e.n=4;break;case 3:e.p=3,n=e.v,console.error("‚ùå HomePresenter Error:",n),this._view.showError(n);case 4:return e.p=4,this._view.hideLoading(),e.f(4);case 5:return e.a(2)}}),e,this,[[0,3,4,5]])}))),function(){return n.apply(this,arguments)})}],t&&p(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();var m=n(602);function y(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return g(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(g(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,g(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,g(f,"constructor",u),g(u,"constructor",c),c.displayName="GeneratorFunction",g(u,o,"GeneratorFunction"),g(f),g(f,o,"Generator"),g(f,r,(function(){return this})),g(f,"toString",(function(){return"[object Generator]"})),(y=function(){return{w:a,m:d}})()}function g(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}g=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){g(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},g(e,t,n,r)}function b(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function w(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){b(a,r,o,i,s,"next",e)}function s(e){b(a,r,o,i,s,"throw",e)}i(void 0)}))}}var k,S="stories",_="saved_stories",E="story-queue",M="auth";function P(){return{showMessageBox:"function"==typeof window.showMessageBox?window.showMessageBox:function(e,t){return console.log("[Message: ".concat(t,"] ").concat(e))},showModalMessageBox:"function"==typeof window.showModalMessageBox?window.showModalMessageBox:function(e,t){return console.log("[Modal: ".concat(e,"] ").concat(t))}}}function O(){return T.apply(this,arguments)}function T(){return(T=w(y().m((function e(){var t,n,r;return y().w((function(e){for(;;)switch(e.n){case 0:if(!k){e.n=1;break}return e.a(2,k);case 1:return t=P(),n=t.showModalMessageBox,e.p=2,e.n=3,(0,m.P2)("story-app-db",1,{upgrade:function(e,t,n,r){console.log("IndexedDB upgrade needed from version ".concat(t," to ").concat(n)),e.objectStoreNames.contains(S)||e.createObjectStore(S,{keyPath:"id"}),e.objectStoreNames.contains(_)||e.createObjectStore(_,{keyPath:"id"}),e.objectStoreNames.contains(E)||e.createObjectStore(E,{keyPath:"id"}),e.objectStoreNames.contains(M)||e.createObjectStore(M)},blocked:function(){n("IndexedDB Terblokir","IndexedDB terblokir. Pastikan tidak ada tab lain yang membuka aplikasi.")},blocking:function(){n("IndexedDB Diblokir","IndexedDB diblokir. Pastikan tidak ada tab lain yang membuka aplikasi.")}});case 3:return k=e.v,console.log("IndexedDB opened successfully."),e.a(2,k);case 4:throw e.p=4,r=e.v,console.error("Failed to open IndexedDB:",r),n("Error Database","Gagal membuka database lokal. Fitur offline mungkin terbatas."),r;case 5:return e.a(2)}}),e,null,[[2,4]])})))).apply(this,arguments)}function j(e,t){return x.apply(this,arguments)}function x(){return x=w(y().m((function e(t,n){var r,o,a,i;return y().w((function(e){for(;;)switch(e.n){case 0:if(k){e.n=1;break}return e.n=1,O();case 1:return r=P(),o=r.showMessageBox,a=r.showModalMessageBox,e.p=2,e.n=3,k.put(t,n);case 3:t===S?o("Cerita berhasil disimpan lokal!","success"):t===_?o("Cerita berhasil disimpan ke daftar tersimpan!","success"):t===E&&o("Cerita ditambahkan ke antrean sinkronisasi!","info"),e.n=5;break;case 4:throw e.p=4,i=e.v,console.error("Error putting story in ".concat(t,":"),i),a("Error Simpan Data","Gagal menyimpan cerita ke ".concat(t,".")),i;case 5:return e.a(2)}}),e,null,[[2,4]])}))),x.apply(this,arguments)}function B(e){return I.apply(this,arguments)}function I(){return(I=w(y().m((function e(t){var n,r,o;return y().w((function(e){for(;;)switch(e.n){case 0:if(k){e.n=1;break}return e.n=1,O();case 1:return n=P(),r=n.showModalMessageBox,e.p=2,e.n=3,k.getAll(t);case 3:return e.a(2,e.v);case 4:throw e.p=4,o=e.v,console.error("Error getting all stories from ".concat(t,":"),o),r("Error Ambil Data","Gagal mengambil cerita dari ".concat(t,".")),o;case 5:return e.a(2)}}),e,null,[[2,4]])})))).apply(this,arguments)}function A(e,t){return G.apply(this,arguments)}function G(){return(G=w(y().m((function e(t,n){var r,o,a;return y().w((function(e){for(;;)switch(e.n){case 0:if(k){e.n=1;break}return e.n=1,O();case 1:return r=P(),o=r.showModalMessageBox,e.p=2,e.n=3,k.get(t,n);case 3:return e.a(2,e.v);case 4:throw e.p=4,a=e.v,console.error("Error getting story by ID from ".concat(t,":"),a),o("Error Ambil Detail","Gagal mengambil detail cerita dari ".concat(t,".")),a;case 5:return e.a(2)}}),e,null,[[2,4]])})))).apply(this,arguments)}function D(e,t){return C.apply(this,arguments)}function C(){return C=w(y().m((function e(t,n){var r,o,a,i;return y().w((function(e){for(;;)switch(e.n){case 0:if(k){e.n=1;break}return e.n=1,O();case 1:return r=P(),o=r.showMessageBox,a=r.showModalMessageBox,e.p=2,e.n=3,k.delete(t,n);case 3:o("Cerita berhasil dihapus!","success"),e.n=5;break;case 4:throw e.p=4,i=e.v,console.error("Error deleting story from ".concat(t,":"),i),a("Error Hapus Data","Gagal menghapus cerita dari ".concat(t,".")),i;case 5:return e.a(2)}}),e,null,[[2,4]])}))),C.apply(this,arguments)}function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function R(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return H(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function z(e,t,n){return(t=V(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return W(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(W(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,W(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,W(f,"constructor",u),W(u,"constructor",c),c.displayName="GeneratorFunction",W(u,o,"GeneratorFunction"),W(f),W(f,o,"Generator"),W(f,r,(function(){return this})),W(f,"toString",(function(){return"[object Generator]"})),(q=function(){return{w:a,m:d}})()}function W(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}W=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){W(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},W(e,t,n,r)}function Z(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function J(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){Z(a,r,o,i,s,"next",e)}function s(e){Z(a,r,o,i,s,"throw",e)}i(void 0)}))}}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,V(r.key),r)}}function V(e){var t=function(e){if("object"!=F(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==F(t)?t:t+""}function Y(){return{showMessageBox:"function"==typeof window.showMessageBox?window.showMessageBox:function(e,t){return console.log("[".concat((null==t?void 0:t.toUpperCase())||"INFO","] ").concat(e))},showModalMessageBox:"function"==typeof window.showModalMessageBox?window.showModalMessageBox:function(e,t){return console.log("[Modal: ".concat(e,"] ").concat(t))}}}var Q=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._apiSource=t,this._locationCache=new Map},t=[{key:"_getLocationName",value:(h=J(q().m((function e(t,n){var r,o,a,i,s,c,u;return q().w((function(e){for(;;)switch(e.n){case 0:if(r="".concat(t,",").concat(n),!this._locationCache.has(r)){e.n=1;break}return e.a(2,this._locationCache.get(r));case 1:return e.p=1,e.n=2,fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(t,"&lon=").concat(n,"&zoom=10&addressdetails=1"));case 2:if(!(o=e.v).ok){e.n=4;break}return e.n=3,o.json();case 3:return a=e.v,i="Unknown Location",a&&a.display_name&&((s=a.address)?(c=[],s.village&&c.push(s.village),s.town&&c.push(s.town),s.city&&c.push(s.city),s.county&&c.push(s.county),s.state&&c.push(s.state),i=c.length>0?c.slice(0,2).join(", "):a.display_name.split(",")[0]):i=a.display_name.split(",")[0]),this._locationCache.set(r,i),e.a(2,i);case 4:e.n=6;break;case 5:e.p=5,u=e.v,console.warn("Error getting location name:",u);case 6:return e.a(2,"".concat(t.toFixed(4),", ").concat(n.toFixed(4)))}}),e,this,[[1,5]])}))),function(e,t){return h.apply(this,arguments)})},{key:"_transformStoryData",value:(p=J(q().m((function e(t){var n,r,o;return q().w((function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2,null);case 1:if(console.log("üîß Transforming story data:",t),n="Unknown Location",!t.lat||!t.lon){e.n=5;break}return e.p=2,e.n=3,this._getLocationName(t.lat,t.lon);case 3:n=e.v,e.n=5;break;case 4:e.p=4,o=e.v,console.warn("Failed to resolve location:",o),n="".concat(t.lat.toFixed(4),", ").concat(t.lon.toFixed(4));case 5:return r=U({id:t.id,title:t.name||t.title||"Untitled Story",description:t.description||"No description available",content:t.description||"No content available",image:t.photoUrl||t.image||null,author:t.author||"Unknown Author",date:t.createdAt||t.date||(new Date).toISOString(),location:n,latitude:t.lat||t.latitude||null,longitude:t.lon||t.longitude||null},t),console.log("‚úÖ Transformed story:",r),e.a(2,r)}}),e,this,[[2,4]])}))),function(e){return p.apply(this,arguments)})},{key:"_transformStoriesArray",value:(d=J(q().m((function e(t){var n,r,o=this;return q().w((function(e){for(;;)switch(e.n){case 0:if(Array.isArray(t)){e.n=1;break}return e.a(2,[]);case 1:return n=t.map((function(e){return o._transformStoryData(e)})),e.n=2,Promise.all(n);case 2:return r=e.v,e.a(2,r.filter((function(e){return null!==e})))}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"getSavedStories",value:(f=J(q().m((function e(){var t,n,r;return q().w((function(e){for(;;)switch(e.n){case 0:Y().showMessageBox,e.p=1,console.log("üìñ StoryRepository: Getting saved stories..."),e.n=2;break;case 2:return e.n=3,B(_);case 3:return t=e.v,console.log("üìñ Raw saved stories from DB:",t),e.n=4,this._transformStoriesArray(t);case 4:return n=e.v,console.log("üìñ Transformed saved stories:",n),e.a(2,n);case 5:return e.p=5,r=e.v,console.error("‚ùå Error fetching saved stories:",r),e.a(2,this._getSavedStoriesFromLocalStorage())}}),e,this,[[1,5]])}))),function(){return f.apply(this,arguments)})},{key:"saveStory",value:(l=J(q().m((function e(t){var n,r,o,a;return q().w((function(e){for(;;)switch(e.n){case 0:if(n=Y(),r=n.showMessageBox,e.p=1,console.log("üíæ StoryRepository: Saving story:",t),t&&t.id){e.n=2;break}throw new Error("Data cerita tidak valid untuk disimpan");case 2:return e.n=3,this._transformStoryData(t);case 3:return o=e.v,console.log("üíæ Transformed story for saving:",o),e.n=4,this.getSavedStories();case 4:if(!e.v.some((function(e){return e.id===t.id}))){e.n=5;break}return r("Cerita sudah tersimpan sebelumnya!","info"),e.a(2);case 5:e.n=6;break;case 6:return e.n=7,j(_,o);case 7:console.log("‚úÖ Story saved to database successfully"),r("Cerita berhasil disimpan!","success"),e.n=9;break;case 8:throw e.p=8,a=e.v,console.error("‚ùå Error saving story:",a),a;case 9:return e.a(2)}}),e,this,[[1,8]])}))),function(e){return l.apply(this,arguments)})},{key:"deleteSavedStory",value:(u=J(q().m((function e(t){var n,r,o;return q().w((function(e){for(;;)switch(e.n){case 0:if(n=Y(),r=n.showMessageBox,e.p=1,console.log("üóëÔ∏è StoryRepository: Deleting saved story:",t),t){e.n=2;break}throw new Error("ID cerita tidak valid untuk dihapus");case 2:e.n=3;break;case 3:return e.n=4,D(_,t);case 4:console.log("‚úÖ Story deleted from database successfully"),r("Cerita berhasil dihapus dari daftar tersimpan!","success"),e.n=6;break;case 5:throw e.p=5,o=e.v,console.error("‚ùå Error deleting saved story:",o),o;case 6:return e.a(2)}}),e,this,[[1,5]])}))),function(e){return u.apply(this,arguments)})},{key:"_getSavedStoriesFromLocalStorage",value:function(){try{var e=localStorage.getItem("savedStories");return e?JSON.parse(e):[]}catch(e){return console.error("Error reading from localStorage:",e),[]}}},{key:"_saveStoryToLocalStorage",value:function(e){try{var t=this._getSavedStoriesFromLocalStorage();t.some((function(t){return t.id===e.id}))||(t.push(e),localStorage.setItem("savedStories",JSON.stringify(t)))}catch(e){throw console.error("Error saving to localStorage:",e),e}}},{key:"_deleteSavedStoryFromLocalStorage",value:function(e){try{var t=this._getSavedStoriesFromLocalStorage().filter((function(t){return t.id!==e}));localStorage.setItem("savedStories",JSON.stringify(t))}catch(e){throw console.error("Error deleting from localStorage:",e),e}}},{key:"login",value:(c=J(q().m((function e(t){var n,r;return q().w((function(e){for(;;)switch(e.n){case 0:if(Y().showModalMessageBox,e.p=1,console.log("StoryRepository: Melakukan login..."),this._apiSource&&"function"==typeof this._apiSource.login){e.n=2;break}throw new Error("API Source tidak tersedia atau tidak memiliki method login");case 2:return e.n=3,this._apiSource.login(t);case 3:if((n=e.v)&&n.loginResult&&n.loginResult.token){e.n=4;break}throw new Error("Response login tidak valid dari server");case 4:return console.log("StoryRepository: Login berhasil"),e.a(2,n);case 5:throw e.p=5,r=e.v,console.error("StoryRepository: Error during login:",r),r;case 6:return e.a(2)}}),e,this,[[1,5]])}))),function(e){return c.apply(this,arguments)})},{key:"register",value:(s=J(q().m((function e(t){var n,r;return q().w((function(e){for(;;)switch(e.n){case 0:if(Y().showModalMessageBox,e.p=1,console.log("StoryRepository: Melakukan registrasi..."),this._apiSource&&"function"==typeof this._apiSource.register){e.n=2;break}throw new Error("API Source tidak tersedia atau tidak memiliki method register");case 2:return e.n=3,this._apiSource.register(t);case 3:return n=e.v,console.log("StoryRepository: Registrasi berhasil"),e.a(2,n);case 4:throw e.p=4,r=e.v,console.error("StoryRepository: Error during registration:",r),r;case 5:return e.a(2)}}),e,this,[[1,4]])}))),function(e){return s.apply(this,arguments)})},{key:"getStories",value:(i=J(q().m((function e(){var t,n,r,o,a,i,s,c,u,l,f,d,p,h,v;return q().w((function(e){for(;;)switch(e.n){case 0:return t=Y(),n=t.showMessageBox,r=t.showModalMessageBox,e.p=1,console.log("üîç StoryRepository: Fetching stories..."),o=[],e.n=2,B(S);case 2:o=e.v;case 3:if(navigator.onLine||!(o.length>0)){e.n=5;break}return n("Memuat cerita dari cache (Anda offline)","info"),e.n=4,this._transformStoriesArray(o);case 4:return a=e.v,console.log("üîç StoryRepository: Returning cached stories (offline):",a),e.a(2,a);case 5:return e.n=6,this._apiSource.getAllStories();case 6:if(i=e.v,console.log("üîç StoryRepository: Raw API stories:",i),!(i&&i.length>0)){e.n=15;break}return e.n=7,this._transformStoriesArray(i);case 7:s=e.v,console.log("üîç StoryRepository: Transformed stories:",s),c=R(s),e.p=8,c.s();case 9:if((u=c.n()).done){e.n=11;break}return l=u.value,e.n=10,j(S,l);case 10:e.n=9;break;case 11:e.n=13;break;case 12:e.p=12,h=e.v,c.e(h);case 13:return e.p=13,c.f(),e.f(13);case 14:return n("Memuat cerita dari server","success"),e.a(2,s);case 15:if(!(o.length>0)){e.n=17;break}return e.n=16,this._transformStoriesArray(o);case 16:return f=e.v,n("Memuat cerita dari cache (API tidak merespons atau kosong)","info"),console.log("üîç StoryRepository: Returning cached stories (API empty):",f),e.a(2,f);case 17:return n("Tidak ada cerita ditemukan.","info"),e.a(2,[]);case 18:e.n=24;break;case 19:return e.p=19,v=e.v,console.error("‚ùå StoryRepository: Error fetching stories:",v),d=[],e.n=20,B(S);case 20:d=e.v;case 21:if(!(d.length>0)){e.n=23;break}return e.n=22,this._transformStoriesArray(d);case 22:return p=e.v,n("Gagal memuat dari server, memuat dari cache.","error"),console.log("üîç StoryRepository: Returning fallback cached stories:",p),e.a(2,p);case 23:return r("Error","Gagal memuat cerita: ".concat(v.message)),e.a(2,[]);case 24:return e.a(2)}}),e,this,[[8,12,13,14],[1,19]])}))),function(){return i.apply(this,arguments)})},{key:"getAllStories",value:function(){var e=J(q().m((function e(){return q().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getStories();case 1:return e.a(2,e.v)}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getStoryDetail",value:(a=J(q().m((function e(t){var n,r,o,a,i,s,c,u,l,f;return q().w((function(e){for(;;)switch(e.n){case 0:return n=Y(),r=n.showMessageBox,o=n.showModalMessageBox,e.p=1,console.log("üîç StoryRepository: Mengambil detail cerita ID: ".concat(t)),a=null,e.n=2,A(S,t);case 2:a=e.v;case 3:if(navigator.onLine||!a){e.n=5;break}return r("Memuat detail cerita dari cache (Anda offline)","info"),e.n=4,this._transformStoryData(a);case 4:return i=e.v,console.log("üîç StoryRepository: Returning cached story detail (offline):",i),e.a(2,i);case 5:if(!this._apiSource||"function"!=typeof this._apiSource.getStoryDetail){e.n=12;break}return e.p=6,e.n=7,this._apiSource.getStoryDetail(t);case 7:if(s=e.v,console.log("üîç StoryRepository: Raw API story detail:",s),!s){e.n=10;break}return e.n=8,this._transformStoryData(s);case 8:return c=e.v,console.log("üîç StoryRepository: Transformed story detail:",c),e.n=9,j(S,c);case 9:return e.a(2,c);case 10:e.n=12;break;case 11:e.p=11,l=e.v,console.warn("‚ö†Ô∏è API error, falling back to cache:",l);case 12:if(!a){e.n=14;break}return r("Memuat detail cerita dari cache (API tidak merespons)","info"),e.n=13,this._transformStoryData(a);case 13:return u=e.v,console.log("üîç StoryRepository: Returning cached story detail (API failed):",u),e.a(2,u);case 14:throw new Error("Cerita tidak ditemukan");case 15:throw e.p=15,f=e.v,console.error("‚ùå StoryRepository: Error fetching story detail:",f),o("Error","Gagal memuat detail cerita: ".concat(f.message)),f;case 16:return e.a(2)}}),e,this,[[6,11],[1,15]])}))),function(e){return a.apply(this,arguments)})},{key:"addStory",value:(o=J(q().m((function e(t){var n,r,o,a,i,s;return q().w((function(e){for(;;)switch(e.n){case 0:if(n=Y(),r=n.showMessageBox,o=n.showModalMessageBox,e.p=1,console.log("StoryRepository: Menambahkan cerita baru..."),this._apiSource&&"function"==typeof this._apiSource.addStory){e.n=2;break}throw new Error("API Source tidak tersedia atau tidak memiliki method addStory");case 2:if(navigator.onLine){e.n=3;break}throw r("Anda offline. Cerita akan diupload saat online kembali.","info"),new Error("Tidak dapat menambahkan cerita saat offline");case 3:return e.n=4,this._apiSource.addStory(t);case 4:if(a=e.v,r("Cerita berhasil ditambahkan!","success"),!a||!a.id){e.n=6;break}return e.n=5,this._transformStoryData(a);case 5:return i=e.v,e.n=6,j(S,i);case 6:return e.a(2,a);case 7:throw e.p=7,s=e.v,console.error("StoryRepository: Error adding story:",s),o("Error","Gagal menambahkan cerita: ".concat(s.message)),s;case 8:return e.a(2)}}),e,this,[[1,7]])}))),function(e){return o.apply(this,arguments)})},{key:"getStoriesWithLocation",value:(r=J(q().m((function e(){var t,n,r,o,a;return q().w((function(e){for(;;)switch(e.n){case 0:if((t=Y()).showMessageBox,n=t.showModalMessageBox,e.p=1,this._apiSource&&"function"==typeof this._apiSource.getStoriesWithLocation){e.n=3;break}return e.n=2,this.getStories();case 2:return e.a(2,e.v);case 3:return e.n=4,this._apiSource.getStoriesWithLocation();case 4:return r=e.v,e.n=5,this._transformStoriesArray(r||[]);case 5:return o=e.v,console.log("üîç StoryRepository: Stories with location:",o),e.a(2,o);case 6:return e.p=6,a=e.v,console.error("Error fetching stories with location:",a),n("Error","Gagal memuat cerita dengan lokasi: ".concat(a.message)),e.a(2,[])}}),e,this,[[1,6]])}))),function(){return r.apply(this,arguments)})},{key:"syncPendingStories",value:(n=J(q().m((function e(){return q().w((function(e){for(;;)switch(e.n){case 0:console.log("Syncing pending stories...");case 1:return e.a(2)}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getStoryById",value:function(){var e=J(q().m((function e(t){return q().w((function(e){for(;;)switch(e.n){case 0:return console.log("üîß StoryRepository: getStoryById dipanggil, delegating ke getStoryDetail"),e.n=1,this.getStoryDetail(t);case 1:return e.a(2,e.v)}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],t&&K(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,o,a,i,s,c,u,l,f,d,p,h}();const X=Q,$="https://story-api.dicoding.dev/v1",ee={REGISTER:"/register",LOGIN:"/login",STORIES:"/stories",STORIES_GUEST:"/stories?size=10&location=1",UPLOAD_STORY:"/stories",SUBSCRIBE_NOTIFICATION:"/notifications/subscribe"};function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ne(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return re(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(re(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,re(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,re(f,"constructor",u),re(u,"constructor",c),c.displayName="GeneratorFunction",re(u,o,"GeneratorFunction"),re(f),re(f,o,"Generator"),re(f,r,(function(){return this})),re(f,"toString",(function(){return"[object Generator]"})),(ne=function(){return{w:a,m:d}})()}function re(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}re=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){re(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},re(e,t,n,r)}function oe(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function ae(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){oe(a,r,o,i,s,"next",e)}function s(e){oe(a,r,o,i,s,"throw",e)}i(void 0)}))}}function ie(){return{showModalMessageBox:"function"==typeof window.showModalMessageBox?window.showModalMessageBox:function(e,t){return console.log("[Modal: ".concat(e,"] ").concat(t))}}}const se={_BASE_URL:"https://story-api.dicoding.dev/v1",login:function(e){var t=this;return ae(ne().m((function n(){var r,o,a,i;return ne().w((function(n){for(;;)switch(n.n){case 0:return ie().showModalMessageBox,n.p=1,console.log("StoryApiSource: Melakukan login ke:","".concat(t._BASE_URL,"/login")),n.n=2,fetch("".concat(t._BASE_URL,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})});case 2:if((r=n.v).ok){n.n=4;break}return n.n=3,r.json();case 3:throw o=n.v,console.error("StoryApiSource: Login gagal:",r.status,o),new Error(o.message||"Login gagal");case 4:return n.n=5,r.json();case 5:return a=n.v,console.log("StoryApiSource: Login berhasil"),n.a(2,a);case 6:throw n.p=6,i=n.v,console.error("Error during login:",i),i;case 7:return n.a(2)}}),n,null,[[1,6]])})))()},register:function(e){var t=this;return ae(ne().m((function n(){var r,o,a,i;return ne().w((function(n){for(;;)switch(n.n){case 0:return ie().showModalMessageBox,n.p=1,console.log("StoryApiSource: Melakukan registrasi ke:","".concat(t._BASE_URL,"/register")),n.n=2,fetch("".concat(t._BASE_URL,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,email:e.email,password:e.password})});case 2:if((r=n.v).ok){n.n=4;break}return n.n=3,r.json();case 3:throw o=n.v,console.error("StoryApiSource: Registrasi gagal:",r.status,o),new Error(o.message||"Registrasi gagal");case 4:return n.n=5,r.json();case 5:return a=n.v,console.log("StoryApiSource: Registrasi berhasil"),n.a(2,a);case 6:throw n.p=6,i=n.v,console.error("Error during registration:",i),i;case 7:return n.a(2)}}),n,null,[[1,6]])})))()},getAllStories:function(){var e=this;return ae(ne().m((function t(){var n,r,o,a,i,c,u,l,f;return ne().w((function(t){for(;;)switch(t.n){case 0:return n=ie(),r=n.showModalMessageBox,t.p=1,o=s(),a=o?{Authorization:"Bearer ".concat(o)}:{},console.log("StoryApiSource: Mengambil semua cerita dari:","".concat(e._BASE_URL,"/stories")),t.n=2,fetch("".concat(e._BASE_URL,"/stories"),{headers:a});case 2:if((i=t.v).ok){t.n=5;break}return t.n=3,i.json();case 3:if(c=t.v,console.error("StoryApiSource: Gagal memuat semua cerita:",i.status,c),401!==i.status){t.n=4;break}return r("Session Expired","Sesi Anda telah berakhir. Silakan login kembali."),localStorage.removeItem("token"),window.location.hash="#/login",t.a(2);case 4:throw r("Error API","Gagal memuat cerita: ".concat(c.message||i.statusText)),new Error("API error: ".concat(c.message||i.statusText));case 5:return t.n=6,i.json();case 6:return u=t.v,l=u.listStory,t.a(2,l);case 7:throw t.p=7,f=t.v,console.error("Error fetching all stories:",f),f;case 8:return t.a(2)}}),t,null,[[1,7]])})))()},getStoryDetail:function(e){var t=this;return ae(ne().m((function n(){var r,o,a,i,c,u,l,f,d,p;return ne().w((function(n){for(;;)switch(n.n){case 0:if(r=ie(),o=r.showModalMessageBox,n.p=1,console.log("üêõ StoryApiSource getStoryDetail:",{id:e,idType:te(e),idLength:null==e?void 0:e.length,finalUrl:"".concat(t._BASE_URL,"/stories/").concat(e)}),e&&"undefined"!==e&&"null"!==e&&""!==e.trim()){n.n=2;break}throw new Error("ID cerita tidak valid untuk API call");case 2:return a=s(),i=a?{Authorization:"Bearer ".concat(a)}:{},c="".concat(t._BASE_URL,"/stories/").concat(e),console.log("StoryApiSource: Mengambil detail cerita dari URL:",c),n.n=3,fetch(c,{headers:i});case 3:if(u=n.v,console.log("üêõ API Response:",{status:u.status,statusText:u.statusText,ok:u.ok,url:u.url}),u.ok){n.n=7;break}return n.n=4,u.json();case 4:if(l=n.v,console.error("StoryApiSource: Gagal memuat detail cerita:",u.status,l),404!==u.status){n.n=5;break}throw new Error('Cerita dengan ID "'.concat(e,'" tidak ditemukan di server'));case 5:if(401!==u.status){n.n=6;break}return o("Session Expired","Sesi Anda telah berakhir. Silakan login kembali."),localStorage.removeItem("token"),window.location.hash="#/login",n.a(2);case 6:throw new Error("API error: ".concat(l.message||u.statusText));case 7:return n.n=8,u.json();case 8:if(f=n.v,console.log("üêõ API Response Data:",f),d=f.story){n.n=9;break}throw new Error("Data cerita tidak valid dari server");case 9:return n.a(2,d);case 10:throw n.p=10,p=n.v,console.error("Error fetching story detail:",p),p;case 11:return n.a(2)}}),n,null,[[1,10]])})))()},addStory:function(e){var t=this;return ae(ne().m((function n(){var r,o,a,i,c,u,l,f;return ne().w((function(n){for(;;)switch(n.n){case 0:if(r=ie(),o=r.showModalMessageBox,n.p=1,i=s()){n.n=2;break}throw new Error("Anda harus login untuk menambahkan cerita.");case 2:return console.log("StoryApiSource: Mengirim cerita baru ke:","".concat(t._BASE_URL,"/stories")),n.n=3,fetch("".concat(t._BASE_URL,"/stories"),{method:"POST",headers:{Authorization:"Bearer ".concat(i)},body:e});case 3:if((c=n.v).ok){n.n=6;break}return n.n=4,c.json();case 4:if(u=n.v,console.error("StoryApiSource: Gagal menambahkan cerita:",c.status,u),401!==c.status){n.n=5;break}return o("Session Expired","Sesi Anda telah berakhir. Silakan login kembali."),localStorage.removeItem("token"),window.location.hash="#/login",n.a(2);case 5:throw o("Error Upload","Gagal mengunggah cerita: ".concat(u.message||c.statusText)),new Error("API error: ".concat(u.message||c.statusText));case 6:return n.n=7,c.json();case 7:return l=n.v,console.log("StoryApiSource:",l.message),n.a(2,(null===(a=l.data)||void 0===a?void 0:a.story)||l);case 8:throw n.p=8,f=n.v,console.error("Error adding story:",f),o("Error Upload",f.message||"Terjadi kesalahan saat menambahkan cerita."),f;case 9:return n.a(2)}}),n,null,[[1,8]])})))()},getStoriesWithLocation:function(){var e=this;return ae(ne().m((function t(){var n,r,o,a,i,c,u,l,f;return ne().w((function(t){for(;;)switch(t.n){case 0:return n=ie(),r=n.showModalMessageBox,t.p=1,o=s(),a=o?{Authorization:"Bearer ".concat(o)}:{},console.log("StoryApiSource: Mengambil cerita dengan lokasi dari:","".concat(e._BASE_URL,"/stories?location=1")),t.n=2,fetch("".concat(e._BASE_URL,"/stories?location=1"),{headers:a});case 2:if((i=t.v).ok){t.n=5;break}return t.n=3,i.json();case 3:if(c=t.v,console.error("StoryApiSource: Gagal memuat cerita dengan lokasi:",i.status,c),401!==i.status){t.n=4;break}return r("Session Expired","Sesi Anda telah berakhir. Silakan login kembali."),localStorage.removeItem("token"),window.location.hash="#/login",t.a(2);case 4:throw r("Error API","Gagal memuat cerita: ".concat(c.message||i.statusText)),new Error("API error: ".concat(c.message||i.statusText));case 5:return t.n=6,i.json();case 6:return u=t.v,l=u.listStory,t.a(2,l);case 7:throw t.p=7,f=t.v,console.error("Error fetching stories with location:",f),f;case 8:return t.a(2)}}),t,null,[[1,7]])})))()},subscribePushNotification:function(e){return ae(ne().m((function t(){var n,r,o,a,i,c,u;return ne().w((function(t){for(;;)switch(t.n){case 0:if(n=ie(),r=n.showModalMessageBox,t.p=1,o=s()){t.n=2;break}throw r("Unauthorized","Anda harus login untuk mengaktifkan notifikasi."),new Error("No access token found. User must be logged in.");case 2:return console.log("StoryApiSource: Sending push subscription to server:",$+ee.SUBSCRIBE_NOTIFICATION),t.n=3,fetch($+ee.SUBSCRIBE_NOTIFICATION,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(e)});case 3:if((a=t.v).ok){t.n=5;break}return t.n=4,a.json();case 4:throw i=t.v,console.error("StoryApiSource: Failed to subscribe to push notifications:",a.status,i),401===a.status&&(r("Session Expired","Sesi Anda telah berakhir. Silakan login kembali."),localStorage.removeItem("token"),window.location.hash="#/login"),new Error(i.message||"Failed to subscribe to notifications.");case 5:return t.n=6,a.json();case 6:return c=t.v,console.log("StoryApiSource: Push subscription successful:",c),t.a(2,a);case 7:throw t.p=7,u=t.v,console.error("Error in subscribePushNotification:",u),u;case 8:return t.a(2)}}),t,null,[[1,7]])})))()},unsubscribePushNotification:function(e){return ae(ne().m((function t(){var n,r,o,a,i,c,u;return ne().w((function(t){for(;;)switch(t.n){case 0:if(n=ie(),r=n.showModalMessageBox,t.p=1,o=s()){t.n=2;break}throw r("Unauthorized","Anda harus login untuk menonaktifkan notifikasi."),new Error("No access token found. User must be logged in.");case 2:return console.log("StoryApiSource: Sending push unsubscription to server:",$+ee.SUBSCRIBE_NOTIFICATION),t.n=3,fetch($+ee.SUBSCRIBE_NOTIFICATION,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({endpoint:e})});case 3:if((a=t.v).ok){t.n=5;break}return t.n=4,a.json();case 4:throw i=t.v,console.error("StoryApiSource: Failed to unsubscribe from push notifications:",a.status,i),401===a.status&&(r("Session Expired","Sesi Anda telah berakhir. Silakan login kembali."),localStorage.removeItem("token"),window.location.hash="#/login"),new Error(i.message||"Failed to unsubscribe from notifications.");case 5:return t.n=6,a.json();case 6:return c=t.v,console.log("StoryApiSource: Push unsubscription successful:",c),t.a(2,a);case 7:throw t.p=7,u=t.v,console.error("Error in unsubscribePushNotification:",u),u;case 8:return t.a(2)}}),t,null,[[1,7]])})))()}};var ce=n(481),ue=n.n(ce);function le(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return fe(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(fe(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,fe(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,fe(f,"constructor",u),fe(u,"constructor",c),c.displayName="GeneratorFunction",fe(u,o,"GeneratorFunction"),fe(f),fe(f,o,"Generator"),fe(f,r,(function(){return this})),fe(f,"toString",(function(){return"[object Generator]"})),(le=function(){return{w:a,m:d}})()}function fe(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}fe=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){fe(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},fe(e,t,n,r)}function de(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function pe(){return{showModalMessageBox:"function"==typeof window.showModalMessageBox?window.showModalMessageBox:function(e,t){return console.log("[Modal: ".concat(e,"] ").concat(t))}}}var he=new Map,ve={initMap:function(e){var t,n,r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=pe().showModalMessageBox;if("string"==typeof e)n=e,t=document.getElementById(n);else{if(!(e instanceof HTMLElement))return console.error("Map container harus berupa ID string atau elemen DOM."),null;t=e,(n=e.id)||(n="leaflet-map-".concat(Date.now()),t.id=n)}if(!t)return console.error('Elemen map dengan ID "'.concat(n,'" tidak ditemukan di DOM.')),null;if(void 0===ue())return console.error("Leaflet tidak tersedia. Ini seharusnya tidak terjadi setelah import."),i("Error Peta","Library peta tidak ditemukan. Ada masalah internal."),null;if(!navigator.onLine)return console.log("MapHelper: Sedang offline, menampilkan fallback map"),this.createOfflineMap(t,o,a);if(t._leaflet_id){console.log("MapHelper: Menghapus peta lama dari elemen ".concat(n," (ditemukan _leaflet_id)."));var s=he.get(n);if(s&&s instanceof ue().Map)s.remove(),he.delete(n);else try{ue().map(n).remove(),console.warn("MapHelper: Berhasil menghapus peta lama secara paksa untuk ".concat(n,"."))}catch(e){return console.error("MapHelper: Gagal menghapus peta lama secara paksa untuk ".concat(n,":"),e.message),i("Error Peta","Gagal membersihkan peta lama di ".concat(n,": ").concat(e.message,".")),null}}try{var c=o.lat||-2.5489,u=o.lng||118.0149,l=o.zoom||5,f=ue().map(n).setView([c,u],l),d=ue().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors",errorTileUrl:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgZmlsbD0iI2YwZjBmMCIvPjx0ZXh0IHg9IjEyOCIgeT0iMTI4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5Ij5PZmZsaW5lPC90ZXh0Pjwvc3ZnPg=="});return d.on("tileerror",(function(e){console.warn("Tile loading error:",e),navigator.onLine||r.showOfflineIndicator(f)})),d.addTo(f),delete ue().Icon.Default.prototype._getIconUrl,ue().Icon.Default.mergeOptions({iconRetinaUrl:"images/marker-icon-2x.png",iconUrl:"images/marker-icon.png",shadowUrl:"images/marker-shadow.png"}),a&&a.length>0&&a.forEach((function(e){if(e.latitude&&e.longitude){var t='\n              <div class="map-popup">\n                <h3>'.concat(e.title,'</h3>\n                <img src="').concat(e.image||"./images/placehold.co_100x75_333_ffffff_text_No_Image.png",'" alt="').concat(e.title,'" style="max-width: 100px; height: auto; border-radius: 5px;">\n                <p>').concat(e.description.substring(0,50)).concat(e.description.length>50?"...":"",'</p>\n                <a href="#/detail/').concat(e.id,'" class="popup-link" style="display: block; margin-top: 5px; color: #be279e; text-decoration: none;">Lihat Detail</a>\n              </div>\n            ');r.addMarker(f,e.latitude,e.longitude,e.title,t)}})),he.set(n,f),this.preCacheMapTiles(c,u,l),f}catch(e){return console.error("MapHelper: Error initializing map:",e),i("Error Peta","Gagal menginisialisasi peta: ".concat(e.message)),this.createOfflineMap(t,o,a)}},createOfflineMap:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=t.lat||-2.5489,o=t.lng||118.0149;return e.innerHTML='\n      <div class="offline-map" style="\n        width: 100%;\n        height: 400px;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        color: white;\n        border-radius: 8px;\n        position: relative;\n        font-family: Arial, sans-serif;\n      ">\n        <div style="text-align: center; z-index: 10;">\n          <div style="font-size: 48px; margin-bottom: 16px;">üó∫Ô∏è</div>\n          <h3 style="margin: 0 0 8px 0;">Peta Offline</h3>\n          <p style="margin: 0; opacity: 0.8;">Latitude: '.concat(r.toFixed(4),'</p>\n          <p style="margin: 0; opacity: 0.8;">Longitude: ').concat(o.toFixed(4),'</p>\n          <p style="margin: 16px 0 0 0; font-size: 14px; opacity: 0.7;">\n            ').concat(n.length>0?"".concat(n.length," cerita di sekitar area ini"):"Peta tidak tersedia saat offline",'\n          </p>\n        </div>\n        \n        \x3c!-- Decorative elements --\x3e\n        <div style="\n          position: absolute;\n          top: 20px;\n          right: 20px;\n          width: 60px;\n          height: 60px;\n          border: 2px solid rgba(255,255,255,0.3);\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 24px;\n        ">üìç</div>\n        \n        ').concat(n.length>0?'\n          <div style="\n            position: absolute;\n            bottom: 20px;\n            left: 20px;\n            right: 20px;\n            background: rgba(255,255,255,0.1);\n            border-radius: 8px;\n            padding: 12px;\n            backdrop-filter: blur(10px);\n          ">\n            <h4 style="margin: 0 0 8px 0; font-size: 14px;">Cerita di Area Ini:</h4>\n            <div style="max-height: 80px; overflow-y: auto;">\n              '.concat(n.slice(0,3).map((function(e){return'\n                <div style="margin-bottom: 4px; font-size: 12px; opacity: 0.9;">\n                  ‚Ä¢ '.concat(e.title,"\n                </div>\n              ")})).join(""),"\n              ").concat(n.length>3?'<div style="font-size: 12px; opacity: 0.7;">...dan '.concat(n.length-3," cerita lainnya</div>"):"","\n            </div>\n          </div>\n        "):"","\n      </div>\n    "),e.dataset.lat=r,e.dataset.lng=o,e.dataset.zoom=t.zoom||5,{isOfflineMap:!0,element:e,lat:r,lng:o,stories:n,remove:function(){e.innerHTML=""}}},showOfflineIndicator:function(e){var t=ue().control({position:"topright"});t.onAdd=function(){var e=ue().DomUtil.create("div","leaflet-control-offline");return e.innerHTML='\n        <div style="\n          background: rgba(255, 0, 0, 0.8);\n          color: white;\n          padding: 8px 12px;\n          border-radius: 4px;\n          font-size: 12px;\n          font-weight: bold;\n        ">\n          üì∂ Offline Mode\n        </div>\n      ',e},t.addTo(e)},preCacheMapTiles:function(e,t){var n,r=arguments,o=this;return(n=le().m((function n(){var a,i,s,c,u;return le().w((function(n){for(;;)switch(n.n){case 0:if(a=r.length>2&&void 0!==r[2]?r[2]:13,navigator.onLine){n.n=1;break}return n.a(2);case 1:return n.p=1,n.n=2,caches.open("maps-tiles-cache");case 2:return i=n.v,s=o.generateTileUrls(e,t,a),c=s.map((function(e){return fetch(e).then((function(t){t.ok&&i.put(e,t.clone())})).catch((function(){}))})),n.n=3,Promise.allSettled(c);case 3:console.log("Pre-cached ".concat(s.length," map tiles for offline use")),n.n=5;break;case 4:n.p=4,u=n.v,console.error("Error pre-caching tiles:",u);case 5:return n.a(2)}}),n,null,[[1,4]])})),function(){var e=this,t=arguments;return new Promise((function(r,o){var a=n.apply(e,t);function i(e){de(a,r,o,i,s,"next",e)}function s(e){de(a,r,o,i,s,"throw",e)}i(void 0)}))})()},generateTileUrls:function(e,t,n){for(var r=[],o=Math.floor((t+180)/360*Math.pow(2,n)),a=Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n)),i=o-1;i<=o+1;i++)for(var s=a-1;s<=a+1;s++)r.push("https://tile.openstreetmap.org/".concat(n,"/").concat(i,"/").concat(s,".png"));return r},setupNetworkDetection:function(){var e=this;window.addEventListener("online",(function(){console.log("Network: Back online"),e.handleNetworkChange(!0)})),window.addEventListener("offline",(function(){console.log("Network: Gone offline"),e.handleNetworkChange(!1)}))},handleNetworkChange:function(e){var t=this,n=document.querySelectorAll(".offline-map");e?n.forEach((function(e){var n=e.parentElement,r=parseFloat(n.dataset.lat),o=parseFloat(n.dataset.lng),a=parseInt(n.dataset.zoom)||5;if(r&&o){var i=n.id;t.initMap(i,{lat:r,lng:o,zoom:a})}})):he.forEach((function(e,n){if(e&&e.remove){var r=e.getCenter(),o=e.getZoom();e.remove();var a=document.getElementById(n);a&&t.createOfflineMap(a,{lat:r.lat,lng:r.lng,zoom:o})}}))},addMarker:function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(e&&e.isOfflineMap)return console.log("Skipping marker addition for offline map"),null;if(!e||void 0===ue())return console.error("Peta tidak valid atau Leaflet tidak tersedia untuk menambahkan marker."),null;if(void 0===t||void 0===n||null===t||null===n)return console.warn("Melewatkan marker untuk ".concat(r," karena koordinat tidak valid: lat=").concat(t,", lon=").concat(n)),null;try{return(a?ue().marker([t,n],{icon:a}):ue().marker([t,n])).addTo(e).bindPopup(o)}catch(e){return console.error("Error adding marker for ".concat(r,":"),e),pe().showModalMessageBox("Error Marker Peta","Gagal menambahkan marker untuk ".concat(r,": ").concat(e.message)),null}},getMapInstance:function(e){var t="string"==typeof e?e:e.id;return he.get(t)}};ve.setupNetworkDetection();const me=ve;function ye(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return ge(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(ge(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,ge(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,ge(f,"constructor",u),ge(u,"constructor",c),c.displayName="GeneratorFunction",ge(u,o,"GeneratorFunction"),ge(f),ge(f,o,"Generator"),ge(f,r,(function(){return this})),ge(f,"toString",(function(){return"[object Generator]"})),(ye=function(){return{w:a,m:d}})()}function ge(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ge=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){ge(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},ge(e,t,n,r)}function be(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function we(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){be(a,r,o,i,s,"next",e)}function s(e){be(a,r,o,i,s,"throw",e)}i(void 0)}))}}const ke={render:function(){return we(ye().m((function e(){return ye().w((function(e){for(;;)if(0===e.n)return e.a(2,'\n      <section class="content">\n        <h2 class="content__heading">List Story</h2>\n        <div class="loading" id="loading" style="display: none;">Memuat cerita...</div>\n        <div class="error-container" id="error-container" style="display: none;"></div>\n        <div id="stories" class="stories"></div>\n        <div id="map" class="map" style="height: 400px; margin-top: 20px;"></div>\n      </section>\n    ')}),e)})))()},afterRender:function(){return we(ye().m((function e(){var t,n,r,a,i,s,c,u;return ye().w((function(e){for(;;)switch(e.n){case 0:return t={showMessageBox:"function"==typeof window.showMessageBox?window.showMessageBox:function(e,t){return console.log("[Message: ".concat(t,"] ").concat(e))},showModalMessageBox:"function"==typeof window.showModalMessageBox?window.showModalMessageBox:function(e,t){return console.log("[Modal: ".concat(e,"] ").concat(t))}},n=t.showModalMessageBox,r=new X(se),a=document.querySelector("#stories"),i=document.querySelector("#loading"),s=document.querySelector("#error-container"),c=document.querySelector("#map"),u=new v({view:{showLoading:function(){i.style.display="block",a.innerHTML="",s.style.display="none"},hideLoading:function(){i.style.display="none"},showError:function(e){s.innerHTML='<p class="error-message">Error: '.concat(e.message||"Something went wrong","</p>"),s.style.display="block",a.innerHTML="",n("Gagal Memuat Cerita",e.message||"Terjadi kesalahan saat memuat cerita.")},showLoginError:function(){s.innerHTML='<div class="empty-state">Silakan login terlebih dahulu untuk melihat cerita.</div>',s.style.display="block",a.innerHTML="",n("Akses Ditolak","Silakan login terlebih dahulu untuk melihat cerita.")},showEmptyStories:function(){a.innerHTML='<div class="empty-state">Tidak ada cerita yang tersedia</div>'},showStories:function(e){console.log("üîç DEBUG: Stories received in view:",e),console.log("üîç DEBUG: Stories length in view:",e.length),e.length>0&&(console.log("üîç DEBUG: First story in view:",e[0]),console.log("üîç DEBUG: Story keys in view:",Object.keys(e[0]))),e.length>0?(a.innerHTML="",e.forEach((function(e,t){console.log("üîç DEBUG: Processing story ".concat(t,":"),e);var n=o(e);console.log("üîç DEBUG: Generated template for story ".concat(t,":"),n),a.innerHTML+=n}))):this.showEmptyStories(),c?this.renderMap(e):(console.error("HomePage: Elemen peta (#map) tidak ditemukan di DOM."),n("Error Peta","Elemen peta tidak ditemukan di halaman beranda."))},showMapError:function(e){c&&(c.innerHTML='<div class="error-message">Map tidak dapat dimuat: '.concat(e,"</div>"),c.style.display="block",n("Error Peta","Peta tidak dapat dimuat: ".concat(e)))},renderMap:function(e){try{if(!c||void 0===ue())return void this.showMapError("Leaflet JS tidak ditemukan atau container peta tidak ada.");if(c._leaflet_id){var t=me.getMapInstance("map");t&&(t.remove(),console.log("MapHelper: Peta lama di beranda dihapus."))}var r=e.length>0&&e[0].latitude?e[0].latitude:-2.5489,o=e.length>0&&e[0].longitude?e[0].longitude:118.0149,a=me.initMap("map",{lat:r,lng:o,zoom:e.length>0?5:4});a?(e.filter((function(e){return e.latitude&&e.longitude})).forEach((function(e){ue().marker([e.latitude,e.longitude]).addTo(a).bindPopup("<b>".concat(e.title,"</b><br>").concat(e.location||"Lokasi tidak diketahui")).on("click",(function(){window.location.hash="#/detail/".concat(e.id)}))})),a.invalidateSize()):(console.error("Leaflet map instance not found for rendering markers in home page."),n("Error Peta","Instans peta Leaflet tidak ditemukan untuk menampilkan marker di beranda."))}catch(e){this.showMapError(e.message)}}},storyRepository:r}),e.n=1,u.init();case 1:return e.a(2)}}),e)})))()}};function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function _e(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Ee(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Ee(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Ee(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,Ee(f,"constructor",u),Ee(u,"constructor",c),c.displayName="GeneratorFunction",Ee(u,o,"GeneratorFunction"),Ee(f),Ee(f,o,"Generator"),Ee(f,r,(function(){return this})),Ee(f,"toString",(function(){return"[object Generator]"})),(_e=function(){return{w:a,m:d}})()}function Ee(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Ee=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){Ee(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},Ee(e,t,n,r)}function Me(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Oe(r.key),r)}}function Oe(e){var t=function(e){if("object"!=Se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Se(t)?t:t+""}const Te=function(){return e=function e(t){var n=t.view;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._view=n,this._storyApiSource=se,this._initListeners()},t=[{key:"_initListeners",value:function(){"function"==typeof this._view.setAddStoryHandler?this._view.setAddStoryHandler(this._addStory.bind(this)):console.error("View passed to AddStoryPresenter is missing setAddStoryHandler method.")}},{key:"_addStory",value:(n=_e().m((function e(t){var n;return _e().w((function(e){for(;;)switch(e.n){case 0:if(e.p=0,s()){e.n=1;break}return"function"==typeof this._view.showError&&this._view.showError(new Error("Anda harus login untuk menambahkan cerita.")),window.location.hash="#/login",e.a(2);case 1:return"function"==typeof this._view.showLoading&&this._view.showLoading(!0),e.n=2,this._storyApiSource.addStory(t);case 2:"function"==typeof this._view.showLoading&&this._view.showLoading(!1),"function"==typeof this._view.showSuccess?this._view.showSuccess():(console.log("Cerita berhasil ditambahkan! Mengarahkan ke halaman utama."),window.location.hash="/"),e.n=4;break;case 3:e.p=3,n=e.v,"function"==typeof this._view.showLoading&&this._view.showLoading(!1),"function"==typeof this._view.showError?this._view.showError(n):(console.error("Terjadi kesalahan saat menambahkan cerita:",n),alert("Terjadi kesalahan saat menambahkan cerita: "+n.message));case 4:return e.a(2)}}),e,this,[[0,3]])})),r=function(){var e=this,t=arguments;return new Promise((function(r,o){var a=n.apply(e,t);function i(e){Me(a,r,o,i,s,"next",e)}function s(e){Me(a,r,o,i,s,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)})}],t&&Pe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function xe(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Be(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Be(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Be(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,Be(f,"constructor",u),Be(u,"constructor",c),c.displayName="GeneratorFunction",Be(u,o,"GeneratorFunction"),Be(f),Be(f,o,"Generator"),Be(f,r,(function(){return this})),Be(f,"toString",(function(){return"[object Generator]"})),(xe=function(){return{w:a,m:d}})()}function Be(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Be=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){Be(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},Be(e,t,n,r)}function Le(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Ie(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){Le(a,r,o,i,s,"next",e)}function s(e){Le(a,r,o,i,s,"throw",e)}i(void 0)}))}}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ge(r.key),r)}}function Ge(e){var t=function(e){if("object"!=je(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==je(t)?t:t+""}function De(){var e="function"==typeof window.showMessageBox?window.showMessageBox:function(e,t){return console.log("[Message: ".concat(t,"] ").concat(e))};return{showModalMessageBox:"function"==typeof window.showModalMessageBox?window.showModalMessageBox:function(e,t){return console.log("[Modal: ".concat(e,"] ").concat(t))},showMessageBox:e}}var Ce=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._presenter=null,this._addStoryHandler=null,this._photoBlob=null,this._map=null,this._marker=null,this._form=null,this._photoPreview=null,this._cameraButton=null,this._fileButton=null,this._photoInput=null,this._camera=null,this._captureButton=null,this._canvas=null,this._selectedLocation=null,this._cancelButton=null,this._originalButtonText=null,this._stream=null,this._customIcon=null},t=[{key:"render",value:(o=Ie(xe().m((function e(){return xe().w((function(e){for(;;)if(0===e.n)return e.a(2,'\n      <div class="add-story-container">\n        <div class="add-story-card">\n          <div class="add-story-header">\n            <h2>Tambah Cerita Baru</h2>\n            <p>Bagikan pengalamanmu dengan foto dan lokasi</p>\n          </div>\n          \n          <form id="add-story-form">\n            <div class="form-group">\n              <label for="description">Cerita</label>\n              <textarea id="description" rows="4" placeholder="Ceritakan pengalamanmu..." required></textarea>\n            </div>\n            \n            <div class="form-group">\n              <label>Foto</label>\n              <div class="photo-container">\n                <div id="photo-preview" class="photo-preview">\n                  <div class="photo-placeholder">\n                    <i class="fa fa-image"></i>\n                    <p>Pratinjau foto akan muncul di sini</p>\n                  </div>\n                </div>\n                <div class="photo-actions">\n                  <button type="button" id="camera-button" class="btn-photo">\n                    <i class="fa fa-camera"></i> Kamera\n                  </button>\n                  <button type="button" id="file-button" class="btn-photo">\n                    <i class="fa fa-file-image"></i> Pilih File\n                  </button>\n                  <input type="file" id="photo-input" accept="image/*" style="display: none;">\n                </div>\n              </div>\n            </div>\n            \n            <div id="camera-container" style="display: none;">\n              <video id="camera" autoplay playsinline class="camera"></video>\n              <button type="button" id="capture-button" class="btn-capture">\n                <i class="fa fa-camera"></i> Ambil Foto\n              </button>\n              <canvas id="canvas" style="display: none;"></canvas>\n            </div>\n            \n            <div class="form-group">\n              <label>Lokasi (Klik pada peta)</label>\n              <div id="location-map" class="map" style="height: 350px;"></div> \n              <div id="selected-location" class="selected-location">\n                <i class="fa fa-map-marker-alt"></i>\n                <span>Belum ada lokasi dipilih</span>\n              </div>\n              <input type="hidden" id="lat" name="lat">\n              <input type="hidden" id="lon" name="lon">\n            </div>\n            \n            <div class="form-actions">\n              <button type="button" id="cancel-button" class="btn-secondary">Batal</button>\n              <button type="submit" class="btn-primary">Bagikan Cerita</button>\n            </div>\n          </form>\n        </div>\n      </div>\n    ')}),e)}))),function(){return o.apply(this,arguments)})},{key:"afterRender",value:(r=Ie(xe().m((function e(){var t,n;return xe().w((function(e){for(;;)switch(e.n){case 0:try{t=De(),n=t.showModalMessageBox,this._initializeElements(),this._presenter=new Te({view:this}),document.getElementById("location-map")?(this._initializeMap(),this._attachEventListeners()):(console.error("AddStoryPage: Elemen peta (#location-map) tidak ditemukan di DOM."),n("Error Halaman","Elemen peta tidak ditemukan. Halaman mungkin tidak berfungsi dengan baik."))}catch(e){console.error("Error pada afterRender AddStoryPage:",e),showModalMessageBox("Error Render Halaman","Gagal memuat halaman tambah cerita.")}case 1:return e.a(2)}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_initializeElements",value:function(){this._form=document.getElementById("add-story-form"),this._photoPreview=document.getElementById("photo-preview"),this._cameraButton=document.getElementById("camera-button"),this._fileButton=document.getElementById("file-button"),this._photoInput=document.getElementById("photo-input"),this._camera=document.getElementById("camera"),this._captureButton=document.getElementById("capture-button"),this._canvas=document.getElementById("canvas"),this._selectedLocation=document.getElementById("selected-location"),this._cancelButton=document.getElementById("cancel-button"),this._form||console.error("Form add-story-form tidak ditemukan"),this._photoPreview||console.error("Photo preview tidak ditemukan"),this._cameraButton||console.error("Camera button tidak ditemukan"),this._fileButton||console.error("File button tidak ditemukan"),this._photoInput||console.error("Photo input tidak ditemukan"),this._camera||console.error("Camera video element tidak ditemukan"),this._captureButton||console.error("Capture button tidak ditemukan"),this._canvas||console.error("Canvas element tidak ditemukan"),this._selectedLocation||console.error("Selected location element tidak ditemukan"),this._cancelButton||console.error("Cancel button tidak ditemukan")}},{key:"_initializeMap",value:function(){var e=this,t=De().showModalMessageBox;try{var n=document.getElementById("location-map");if(!n)return console.error("Element location-map tidak ditemukan. Tidak dapat menginisialisasi peta."),void t("Error Peta","Elemen peta tidak ditemukan di halaman tambah cerita.");if(void 0===ue())return console.error("Leaflet JS tidak tersedia. Tidak dapat menginisialisasi peta."),void t("Error Peta","Library peta tidak ditemukan. Pastikan Leaflet dimuat dengan benar.");this._map=me.initMap("location-map",{lat:-2.5489,lng:118.0149,zoom:5}),this._map?(setTimeout((function(){e._map.invalidateSize()}),100),this._map.on("click",(function(t){var n=t.latlng,r=n.lat,o=n.lng;document.getElementById("lat").value=r,document.getElementById("lon").value=o,e._selectedLocation.innerHTML='\n            <i class="fa fa-map-marker-alt"></i>\n            <span>Lokasi dipilih: '.concat(r.toFixed(6),", ").concat(o.toFixed(6),'</span>\n            <button type="button" id="reset-location" class="btn-reset">\n              <i class="fa fa-times"></i>\n            </button>\n          ');var a=document.getElementById("reset-location");a&&a.addEventListener("click",(function(t){t.stopPropagation(),document.getElementById("lat").value="",document.getElementById("lon").value="",e._selectedLocation.innerHTML='\n                <i class="fa fa-map-marker-alt"></i>\n                <span>Belum ada lokasi dipilih</span>\n              ',e._marker&&(e._map.removeLayer(e._marker),e._marker=null)})),e._marker&&e._map.removeLayer(e._marker),e._marker=ue().marker([r,o]).addTo(e._map)}))):(n.innerHTML='<div class="error-message">Map tidak dapat dimuat.</div>',t("Error Peta","Gagal menginisialisasi peta. Pastikan Leaflet dimuat dengan benar."))}catch(e){console.error("Error initializing map in AddStoryPage:",e);var r=document.getElementById("location-map");r&&(r.innerHTML='<div class="error-message">Map tidak dapat dimuat</div>'),t("Error Peta","Gagal memuat peta lokasi: "+e.message)}}},{key:"_attachEventListeners",value:function(){var e=this,t=De().showMessageBox;try{var n,r,o,a,i,s;null===(n=this._cameraButton)||void 0===n||n.addEventListener("click",this._activateCamera.bind(this)),null===(r=this._captureButton)||void 0===r||r.addEventListener("click",this._captureImage.bind(this)),null===(o=this._fileButton)||void 0===o||o.addEventListener("click",(function(){var t;return null===(t=e._photoInput)||void 0===t?void 0:t.click()})),null===(a=this._photoInput)||void 0===a||a.addEventListener("change",this._handleFileUpload.bind(this)),null===(i=this._cancelButton)||void 0===i||i.addEventListener("click",this._handleCancel.bind(this)),null===(s=this._form)||void 0===s||s.addEventListener("submit",(function(n){n.preventDefault();var r=document.getElementById("description").value,o=document.getElementById("lat").value,a=document.getElementById("lon").value;if(r)if(e._photoBlob){var i=new FormData;i.append("description",r),i.append("photo",e._photoBlob),o&&a&&(i.append("lat",o),i.append("lon",a)),e._addStoryHandler?e._addStoryHandler(i):(console.error("Add story handler not set in presenter."),t("Terjadi kesalahan saat memproses cerita.","error"))}else t("Silakan pilih atau ambil foto","error");else t("Cerita tidak boleh kosong","error")}))}catch(e){console.error("Error attaching event listeners:",e),t("Gagal menginisialisasi interaksi halaman.","error")}}},{key:"_activateCamera",value:(n=Ie(xe().m((function e(){var t,n,r,o,a;return xe().w((function(e){for(;;)switch(e.n){case 0:if(t=De(),n=t.showMessageBox,e.p=1,r=document.getElementById("camera-container")){e.n=2;break}return e.a(2);case 2:return r.style.display="block",e.n=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:o=e.v,this._camera.srcObject=o,this._stream=o,e.n=5;break;case 4:e.p=4,a=e.v,console.error("Error accessing camera:",a),n("Tidak dapat mengakses kamera. Pastikan browser memiliki izin.","error");case 5:return e.a(2)}}),e,this,[[1,4]])}))),function(){return n.apply(this,arguments)})},{key:"_captureImage",value:function(){var e=this,t=De().showMessageBox;try{if(!this._camera||!this._canvas)return void t("Kamera atau canvas tidak siap.","error");var n=this._camera.videoWidth,r=this._camera.videoHeight;this._canvas.width=n,this._canvas.height=r,this._canvas.getContext("2d").drawImage(this._camera,0,0,n,r),this._canvas.toBlob((function(t){e._photoBlob=t;var n=new FileReader;n.onload=function(t){if(e._photoPreview){e._photoPreview.innerHTML='\n                <img src="'.concat(t.target.result,'" alt="Preview">\n                <button type="button" class="btn-remove-photo">\n                  <i class="fa fa-trash"></i>\n                </button>\n              ');var n=e._photoPreview.querySelector(".btn-remove-photo");n&&n.addEventListener("click",(function(){e._photoBlob=null,e._photoInput.value="",e._photoPreview.innerHTML='\n                    <div class="photo-placeholder">\n                      <i class="fa fa-image"></i>\n                      <p>Pratinjau foto akan muncul di sini</p>\n                    </div>\n                  '}))}},n.readAsDataURL(t),e._stopCamera(),document.getElementById("camera-container").style.display="none"}),"image/jpeg",.8)}catch(e){console.error("Error capturing image:",e),t("Gagal mengambil gambar","error")}}},{key:"_stopCamera",value:function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._camera&&(this._camera.srcObject=null))}},{key:"_handleFileUpload",value:function(e){var t=this,n=De().showMessageBox;try{var r=e.target.files[0];if(!r)return;if(!r.type.match("image.*"))return void n("Hanya file gambar yang diperbolehkan","error");this._photoBlob=r;var o=new FileReader;o.onload=function(e){if(t._photoPreview){t._photoPreview.innerHTML='\n            <img src="'.concat(e.target.result,'" alt="Preview">\n            <button type="button" class="btn-remove-photo">\n              <i class="fa fa-trash"></i>\n            </button>\n          ');var n=t._photoPreview.querySelector(".btn-remove-photo");n&&n.addEventListener("click",(function(){t._photoBlob=null,t._photoInput.value="",t._photoPreview.innerHTML='\n                <div class="photo-placeholder">\n                  <i class="fa fa-image"></i>\n                  <p>Pratinjau foto akan muncul di sini</p>\n                </div>\n              '}))}},o.readAsDataURL(r)}catch(e){console.error("Error handling file upload:",e),n("Gagal mengunggah file","error")}}},{key:"_handleCancel",value:function(){var e=De().showModalMessageBox;this._stopCamera(),e("Konfirmasi Batal","Apakah Anda yakin ingin membatalkan?",(function(e){e&&(window.location.hash="/")}),!0)}},{key:"setAddStoryHandler",value:function(e){this._addStoryHandler=e}},{key:"showLoading",value:function(){try{if(!this._form)return;var e=this._form.querySelector('button[type="submit"]');e&&(this._originalButtonText=e.innerHTML,e.innerHTML='<i class="fa fa-spinner fa-spin"></i> Mengirim...',e.disabled=!0)}catch(e){console.error("Error showing loading:",e)}}},{key:"hideLoading",value:function(){try{if(!this._form)return;var e=this._form.querySelector('button[type="submit"]');e&&this._originalButtonText&&(e.innerHTML=this._originalButtonText,e.disabled=!1)}catch(e){console.error("Error hiding loading:",e)}}},{key:"showSuccessMessage",value:function(e){(0,De().showMessageBox)(e,"success");try{if(this._form){var t=this._form.querySelector('button[type="submit"]');t&&(t.innerHTML='<i class="fa fa-check"></i> Berhasil!')}setTimeout((function(){window.location.hash="/"}),2e3)}catch(e){console.error("Error showing success message:",e),setTimeout((function(){window.location.hash="/"}),2e3)}}},{key:"showError",value:function(e){(0,De().showMessageBox)("Error: ".concat(e.message||"Terjadi kesalahan"),"error")}},{key:"resetForm",value:function(){try{this._form&&this._form.reset(),this._photoBlob=null,this._photoPreview&&(this._photoPreview.innerHTML='\n          <div class="photo-placeholder">\n            <i class="fa fa-image"></i>\n            <p>Pratinjau foto akan muncul di sini</p>\n          </div>\n        '),this._marker&&this._map&&(this._map.removeLayer(this._marker),this._marker=null),this._selectedLocation&&(this._selectedLocation.innerHTML='\n          <i class="fa fa-map-marker-alt"></i>\n          <span>Belum ada lokasi dipilih</span>\n        ');var e=document.getElementById("lat"),t=document.getElementById("lon");e&&(e.value=""),t&&(t.value="")}catch(e){console.error("Error resetting form:",e)}}}],t&&Ae(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,o}();const Fe=Ce;function Re(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return He(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(He(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,He(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,He(f,"constructor",u),He(u,"constructor",c),c.displayName="GeneratorFunction",He(u,o,"GeneratorFunction"),He(f),He(f,o,"Generator"),He(f,r,(function(){return this})),He(f,"toString",(function(){return"[object Generator]"})),(Re=function(){return{w:a,m:d}})()}function He(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}He=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){He(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},He(e,t,n,r)}function Ne(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Ue(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){Ne(a,r,o,i,s,"next",e)}function s(e){Ne(a,r,o,i,s,"throw",e)}i(void 0)}))}}const ze={render:function(){return Ue(Re().m((function e(){return Re().w((function(e){for(;;)if(0===e.n)return e.a(2,'\n        <section class="card">\n          <h2 class="text-xl font-semibold mb-4 text-gray-800">üìñ StoryShare - Story App</h2>\n          <p class="text-gray-700">StoryShare adalah aplikasi berbasis web untuk membagikan cerita pribadi dalam bentuk teks dan gambar. Aplikasi ini memungkinkan pengguna untuk menulis cerita, melihat cerita dari pengguna lain, dan membagikan pengalaman mereka secara interaktif dengan fitur lokasi dan notifikasi.</p>\n          <p class="text-gray-700 mt-2">Dibuat untuk submission Dicoding Web Intermediate.</p>\n        </section>\n      ')}),e)})))()},afterRender:function(){return Ue(Re().m((function e(){return Re().w((function(e){for(;;)if(0===e.n)return e.a(2)}),e)})))()}},qe={parseActiveUrlWithCombiner:function(){var e=window.location.hash.slice(1),t=this._urlSplitter(e);return this._urlCombiner(t)},parseActiveUrlWithoutCombiner:function(){var e=window.location.hash.slice(1);return this._urlSplitter(e)},_urlSplitter:function(e){var t=e.split("/");return{resource:t[1]?t[1].toLowerCase():null,id:t[2]||null,verb:t[3]?t[3].toLowerCase():null}},_urlCombiner:function(e){return null===e.resource?"/":null===e.id?"/".concat(e.resource):null===e.verb?"/".concat(e.resource,"/:id"):"/".concat(e.resource,"/:id/").concat(e.verb)}};function We(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Ze(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Ze(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Ze(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,Ze(f,"constructor",u),Ze(u,"constructor",c),c.displayName="GeneratorFunction",Ze(u,o,"GeneratorFunction"),Ze(f),Ze(f,o,"Generator"),Ze(f,r,(function(){return this})),Ze(f,"toString",(function(){return"[object Generator]"})),(We=function(){return{w:a,m:d}})()}function Ze(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Ze=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){Ze(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},Ze(e,t,n,r)}function Je(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Ke(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){Je(a,r,o,i,s,"next",e)}function s(e){Je(a,r,o,i,s,"throw",e)}i(void 0)}))}}function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Qe(r.key),r)}}function Qe(e){var t=function(e){if("object"!=Ve(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ve(t)?t:t+""}const Xe=function(){return e=function e(t){var n=t.view,r=t.storyRepository,o=t.id;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._view=n,this._storyRepository=r,this._id=o,console.log("üêõ DetailPresenter constructor:",{id:this._id,idType:Ve(this._id),view:!!this._view,repository:!!this._storyRepository})},t=[{key:"init",value:(r=Ke(We().m((function e(){return We().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,this._showStory();case 1:return e.a(2)}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_showStory",value:(n=Ke(We().m((function e(){var t,n,r;return We().w((function(e){for(;;)switch(e.n){case 0:if(this._view.showLoading(),e.p=1,console.log("üêõ DetailPresenter: ID info:",{originalId:this._id,idType:Ve(this._id),idLength:null===(t=this._id)||void 0===t?void 0:t.length,currentUrl:window.location.hash,parsedUrl:window.location.hash.split("/")}),this._id&&"undefined"!==this._id&&"null"!==this._id){e.n=2;break}throw new Error("ID cerita tidak valid");case 2:return console.log("DetailPresenter: Mencoba mengambil cerita dengan ID:",this._id),e.n=3,this._storyRepository.getStoryDetail(this._id);case 3:if(n=e.v){e.n=4;break}throw console.error("DetailPresenter: Cerita dengan ID",this._id,"tidak ditemukan dari repository."),new Error("Cerita tidak ditemukan atau gagal dimuat.");case 4:console.log("DetailPresenter: Cerita berhasil diambil:",n),this._view.showStoryDetail(n),e.n=6;break;case 5:e.p=5,r=e.v,console.error("DetailPresenter: Error saat menampilkan cerita:",r),this._view.showError(r);case 6:return e.p=6,this._view.hideLoading(),e.f(6);case 7:return e.a(2)}}),e,this,[[1,5,6,7]])}))),function(){return n.apply(this,arguments)})}],t&&Ye(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function $e(e){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$e(e)}function et(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return tt(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(tt(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,tt(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,tt(f,"constructor",u),tt(u,"constructor",c),c.displayName="GeneratorFunction",tt(u,o,"GeneratorFunction"),tt(f),tt(f,o,"Generator"),tt(f,r,(function(){return this})),tt(f,"toString",(function(){return"[object Generator]"})),(et=function(){return{w:a,m:d}})()}function tt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}tt=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){tt(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},tt(e,t,n,r)}function nt(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function rt(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){nt(a,r,o,i,s,"next",e)}function s(e){nt(a,r,o,i,s,"throw",e)}i(void 0)}))}}const ot={render:function(){return rt(et().m((function e(){return et().w((function(e){for(;;)if(0===e.n)return e.a(2,'\n      <div class="content">\n        <h2 class="content__heading">Story Detail</h2>\n        <div id="story" class="story"></div>\n        <div id="loading" class="loading-indicator" style="display: none;">Memuat...</div>\n        <div id="error-container" class="error-container" style="display: none;"></div>\n        \x3c!-- Container untuk peta dengan offline support --\x3e\n        <div id="detail-map-container" style="height: 400px; margin-top: 20px; position: relative;">\n          <div id="map-loading" class="map-loading" style="display: none;">\n            <div class="loading-content">\n              <div class="spinner"></div>\n              <p>Memuat peta...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    ')}),e)})))()},afterRender:function(){return rt(et().m((function e(){var t,n,r,o,i,s,c,u,l,f,d,p;return et().w((function(e){for(;;)switch(e.n){case 0:if(t={showModalMessageBox:"function"==typeof window.showModalMessageBox?window.showModalMessageBox:function(e,t){return console.log("[Modal: ".concat(e,"] ").concat(t))}},n=t.showModalMessageBox,r=document.querySelector("#story"),o=document.querySelector("#loading"),i=document.querySelector("#error-container"),s=document.querySelector("#detail-map-container"),c=document.querySelector("#map-loading"),u=qe.parseActiveUrlWithoutCombiner(),l=u.id,console.log("üêõ DetailPage afterRender:",{currentHash:window.location.hash,currentHashRaw:window.location.hash.slice(1),parsedUrl:u,rawId:l,idType:$e(l),hashParts:window.location.hash.slice(1).split("/")}),l&&""!==l.trim()&&"undefined"!==l&&"null"!==l){e.n=1;break}return console.error("‚ùå DetailPage: Invalid or missing story ID:",{id:l,hash:window.location.hash,urlParts:window.location.hash.slice(1).split("/")}),n("Error Navigasi","ID cerita tidak ditemukan di URL. Pastikan Anda mengakses link yang benar."),i.innerHTML='\n          <div class="error-message">\n            <h3>Error: ID cerita tidak valid</h3>\n            <p>URL saat ini: <code>'.concat(window.location.hash,"</code></p>\n            <p>ID yang terdeteksi: <code>").concat(l||"null",'</code></p>\n            <button onclick="window.location.hash=\'#/\'" class="btn-back">‚Üê Kembali ke Beranda</button>\n          </div>\n        '),i.style.display="block",o.style.display="none",e.a(2);case 1:return l=l.trim(),console.log("‚úÖ DetailPage: Using cleaned story ID:",{original:u.id,cleaned:l,length:l.length}),f=new X(se),d={showLoading:function(){console.log("üîÑ DetailPage View: Showing loading..."),o.style.display="block",r.innerHTML="",i.style.display="none"},hideLoading:function(){console.log("‚úÖ DetailPage View: Hiding loading..."),o.style.display="none"},showError:function(e){console.error("‚ùå DetailPage View: Showing error:",e);var t="Gagal memuat detail cerita.",o=e.message||"Unknown error",a=[];e.message.includes("tidak ditemukan")||e.message.includes("404")?(t="Cerita tidak ditemukan",a=["Pastikan ID cerita benar","Cerita mungkin sudah dihapus","Coba refresh halaman atau kembali ke beranda"]):e.message.includes("network")||e.message.includes("fetch")?(t="Masalah koneksi jaringan",a=["Periksa koneksi internet Anda","Coba refresh halaman","Server mungkin sedang bermasalah"]):(e.message.includes("401")||e.message.includes("unauthorized"))&&(t="Sesi telah berakhir",a=["Silakan login kembali","Token akses mungkin sudah kedaluwarsa"]),i.innerHTML='\n          <div class="error-message">\n            <h3>‚ùå '.concat(t,"</h3>\n            <p><strong>ID Cerita:</strong> <code>").concat(l,"</code></p>\n            <p><strong>Detail Error:</strong> ").concat(o,"</p>\n            ").concat(a.length>0?'\n              <div class="error-suggestions">\n                <p><strong>Saran:</strong></p>\n                <ul>\n                  '.concat(a.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"\n                </ul>\n              </div>\n            "):"",'\n            <div class="error-actions">\n              <button onclick="window.location.reload()" class="btn-retry">üîÑ Coba Lagi</button>\n              <button onclick="window.location.hash=\'#/\'" class="btn-back">‚Üê Kembali ke Beranda</button>\n            </div>\n          </div>\n        '),i.style.display="block",r.innerHTML="",n("Error Memuat Cerita",t)},showStoryDetail:function(e){if(console.log("‚úÖ DetailPage View: Showing story detail:",e),!e||!e.id)return console.error("‚ùå Invalid story data received:",e),void this.showError(new Error("Data cerita tidak valid dari server"));r.innerHTML=a(e),e.latitude&&e.longitude?(console.log("üó∫Ô∏è Rendering offline-capable map for story location"),this.renderOfflineMap(e.latitude,e.longitude,e.location||e.name||"Lokasi Cerita")):(console.log("‚ÑπÔ∏è No location data available for map"),s&&(s.innerHTML='<div class="info-message">üìç Lokasi tidak tersedia untuk cerita ini</div>',s.style.display="block"));var t=document.getElementById("saveStoryBtn");t?t.addEventListener("click",function(){var r=rt(et().m((function r(o){var a,i;return et().w((function(r){for(;;)switch(r.n){case 0:return o.preventDefault(),console.log("üîÑ Save button clicked, story:",e),t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Menyimpan...',r.p=1,r.n=2,new Promise((function(e){"function"==typeof n&&n.length>=3?n("Konfirmasi Simpan","Apakah Anda yakin ingin menyimpan cerita ini?",e,!0):e(confirm("Apakah Anda yakin ingin menyimpan cerita ini?"))}));case 2:if(!r.v){r.n=6;break}if(console.log("üîÑ User confirmed, saving story..."),f){r.n=3;break}throw new Error("StoryRepository tidak tersedia");case 3:if("function"==typeof f.saveStory){r.n=4;break}throw new Error("Method saveStory tidak tersedia di StoryRepository");case 4:return r.n=5,f.saveStory(e);case 5:t.innerHTML='<i class="fas fa-check"></i> Tersimpan!',t.classList.add("success"),setTimeout((function(){t.innerHTML='<i class="fas fa-bookmark"></i> Simpan Story',t.classList.remove("success"),t.disabled=!1}),2e3),console.log("‚úÖ Story saved successfully"),r.n=7;break;case 6:console.log("‚ÑπÔ∏è User cancelled save operation"),t.innerHTML='<i class="fas fa-bookmark"></i> Simpan Story',t.disabled=!1;case 7:r.n=9;break;case 8:r.p=8,i=r.v,console.error("‚ùå Failed to save story:",i),t.innerHTML='<i class="fas fa-exclamation-triangle"></i> Gagal Menyimpan',t.classList.add("error"),t.disabled=!1,a=i.message||"Terjadi kesalahan saat menyimpan cerita",n("Simpan Gagal",a),setTimeout((function(){t.innerHTML='<i class="fas fa-bookmark"></i> Simpan Story',t.classList.remove("error")}),3e3);case 9:return r.a(2)}}),r,null,[[1,8]])})));return function(e){return r.apply(this,arguments)}}()):console.error("‚ùå Save button not found in DOM");var o=document.getElementById("tryNotificationBtn");o&&o.addEventListener("click",(function(){console.log("üîî Notification button clicked"),n("Notifikasi Percobaan","Anda akan mendapatkan notifikasi untuk: ".concat(e.title||e.name))}));var i=document.getElementById("backToListBtn");i&&i.addEventListener("click",(function(){console.log("üîô Back button clicked"),window.location.hash="#/"}))},renderOfflineMap:function(e,t){var n=arguments,r=this;return rt(et().m((function o(){var a,i,u,l;return et().w((function(o){for(;;)switch(o.n){case 0:if(a=n.length>2&&void 0!==n[2]?n[2]:"Lokasi Cerita",s){o.n=1;break}return console.error("‚ùå Map container not found"),o.a(2);case 1:if(c&&(c.style.display="flex"),o.p=2,"undefined"!=typeof L){o.n=3;break}throw new Error("Leaflet library tidak tersedia");case 3:return i="story-detail-map",s.innerHTML='\n              <div id="'.concat(i,'" style="height: 100%; width: 100%;"></div>\n              <div class="map-controls">\n                <button id="map-info-btn" class="map-info-btn" title="Info Cache Map">\n                  <i class="fas fa-info-circle"></i>\n                </button>\n                <button id="clear-cache-btn" class="clear-cache-btn" title="Bersihkan Cache Map">\n                  <i class="fas fa-trash"></i>\n                </button>\n              </div>\n            '),o.n=4,mapUtilsOffline.initOfflineMap(i,e,t,13);case 4:if(!(u=o.v)){o.n=5;break}console.log("‚úÖ Offline map initialized successfully"),r.addMapControls(u),c&&(c.style.display="none"),setTimeout((function(){u.invalidateSize()}),100),o.n=6;break;case 5:throw new Error("Gagal menginisialisasi map instance");case 6:o.n=8;break;case 7:return o.p=7,l=o.v,console.error("‚ùå Error rendering offline map:",l),c&&(c.style.display="none"),console.log("üîÑ Falling back to original MapHelper..."),o.n=8,r.renderFallbackMap(e,t,a);case 8:return o.a(2)}}),o,null,[[2,7]])})))()},renderFallbackMap:function(e,t,n){return rt(et().m((function r(){var o,a,i;return et().w((function(r){for(;;)switch(r.n){case 0:if(r.p=0,void 0===me||!me.initMap){r.n=3;break}if(o="story-detail-map-fallback",s.innerHTML='<div id="'.concat(o,'" style="height: 100%; width: 100%;"></div>'),me.initMap(document.getElementById(o),{lat:e,lng:t,zoom:13}),!(a=me.getMapInstance(document.getElementById(o)))){r.n=1;break}L.marker([e,t]).addTo(a).bindPopup(n).openPopup(),a.invalidateSize(),console.log("‚úÖ Fallback map rendered successfully"),r.n=2;break;case 1:throw new Error("Fallback map instance not found");case 2:r.n=4;break;case 3:throw new Error("MapHelper tidak tersedia");case 4:r.n=6;break;case 5:r.p=5,i=r.v,console.error("‚ùå Fallback map also failed:",i),s.innerHTML='\n              <div class="error-message">\n                <h4>‚ùå Peta tidak dapat dimuat</h4>\n                <p>Lokasi: '.concat(n,"</p>\n                <p>Koordinat: ").concat(e,", ").concat(t,"</p>\n                <p>Error: ").concat(i.message,'</p>\n                <button onclick="window.location.reload()" class="btn-retry">üîÑ Coba Lagi</button>\n              </div>\n            ');case 6:return r.a(2)}}),r,null,[[0,5]])})))()},addMapControls:function(e){var t=document.getElementById("map-info-btn"),r=document.getElementById("clear-cache-btn");t&&t.addEventListener("click",rt(et().m((function e(){var t;return et().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,mapUtilsOffline.getCacheInfo();case 1:t=e.v,n("Info Cache Map","\n                  Tiles tersimpan: ".concat(t.tileCount,"\n                  Status: ").concat(t.isOnline?"Online":"Offline","\n                  Map instances: ").concat(t.mapInstances,"\n                "));case 2:return e.a(2)}}),e)})))),r&&r.addEventListener("click",rt(et().m((function e(){return et().w((function(e){for(;;)switch(e.n){case 0:if(!confirm("Apakah Anda yakin ingin menghapus cache map? Ini akan menghapus semua tiles yang tersimpan.")){e.n=2;break}return e.n=1,mapUtilsOffline.clearTileCache();case 1:n("Cache Dibersihkan","Cache map telah berhasil dibersihkan.");case 2:return e.a(2)}}),e)}))))}},console.log("üöÄ Initializing DetailPresenter with cleaned ID:",l),p=new Xe({view:d,storyRepository:f,id:l}),e.n=2,p.init();case 2:return e.a(2)}}),e)})))()}};function at(e){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(e)}function it(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return st(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(st(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,st(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,st(f,"constructor",u),st(u,"constructor",c),c.displayName="GeneratorFunction",st(u,o,"GeneratorFunction"),st(f),st(f,o,"Generator"),st(f,r,(function(){return this})),st(f,"toString",(function(){return"[object Generator]"})),(it=function(){return{w:a,m:d}})()}function st(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}st=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){st(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},st(e,t,n,r)}function ct(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,lt(r.key),r)}}function lt(e){var t=function(e){if("object"!=at(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=at(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==at(t)?t:t+""}const ft=function(){return e=function e(t){var n=t.view;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._view=n,this._storyRepository=new X(se),this._listenToLoginForm()},t=[{key:"_listenToLoginForm",value:function(){this._view.setLoginHandler(this._login.bind(this))}},{key:"_login",value:(n=it().m((function e(t){var n,r;return it().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,this._validateLoginData(t),this._view.showLoading(),e.n=1,this._storyRepository.login(t);case 1:if((n=e.v)&&n.loginResult&&n.loginResult.token){e.n=2;break}throw new Error("Response login tidak valid");case 2:o=n.loginResult.token,localStorage.setItem("token",o),console.log("Login berhasil, token disimpan"),this._view.redirectToHome(),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Error during login:",r),this._view.showError(r);case 4:return e.p=4,this._view.hideLoading(),e.f(4);case 5:return e.a(2)}var o}),e,this,[[0,3,4,5]])})),r=function(){var e=this,t=arguments;return new Promise((function(r,o){var a=n.apply(e,t);function i(e){ct(a,r,o,i,s,"next",e)}function s(e){ct(a,r,o,i,s,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)})},{key:"_validateLoginData",value:function(e){var t=e.email,n=e.password;if(!t||!n)throw new Error("Email dan password wajib diisi");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))throw new Error("Format email tidak valid");if(n.length<6)throw new Error("Password minimal 6 karakter")}}],t&&ut(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function dt(e){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dt(e)}function pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ht(r.key),r)}}function ht(e){var t=function(e){if("object"!=dt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==dt(t)?t:t+""}function vt(){return{showModalMessageBox:"function"==typeof window.showModalMessageBox?window.showModalMessageBox:function(e,t){return console.log("[Modal: ".concat(e,"] ").concat(t))}}}const mt=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._loginHandler=null,this._presenter=null},(t=[{key:"render",value:function(){return'\n      <div class="login-container">\n        <div class="login-card">\n          <div class="login-header">\n            <h2>Login ke StoryShare</h2>\n            <p>Bagikan cerita Anda dengan dunia</p>\n          </div>\n          <form id="loginForm" class="login-form">\n            <div class="form-group">\n              <label for="email">Email</label>\n              <div class="input-with-icon">\n                <i class="fas fa-envelope"></i>\n                <input type="email" id="email" name="email" placeholder="Masukkan email Anda" required>\n              </div>\n            </div>\n            \n            <div class="form-group">\n              <label for="password">Password</label>\n              <div class="input-with-icon">\n                <i class="fas fa-lock"></i>\n                <input type="password" id="password" name="password" placeholder="Masukkan password Anda" required>\n                <button type="button" id="togglePassword" class="toggle-password">\n                    <i class="fas fa-eye"></i>\n                </button>\n              </div>\n            </div>\n            \n            <div class="form-options">\n                <div class="remember-me">\n                    <input type="checkbox" id="rememberMe">\n                    <label for="rememberMe">Ingat saya</label>\n                </div>\n                <a href="#" class="forgot-password">Lupa Password?</a>\n            </div>\n            \n            <button type="submit" id="loginButton" class="btn-login">Login</button>\n            \n            <div class="login-footer">\n              Belum punya akun? <a href="#/register">Daftar di sini</a>\n            </div>\n          </form>\n        </div>\n      </div>\n    '}},{key:"afterRender",value:function(){this._presenter=new ft({view:this}),this._attachLoginFormListener();var e=document.getElementById("togglePassword"),t=document.getElementById("password");e&&t&&e.addEventListener("click",(function(){var n="password"===t.getAttribute("type")?"text":"password";t.setAttribute("type",n),e.querySelector("i").classList.toggle("fa-eye"),e.querySelector("i").classList.toggle("fa-eye-slash")}))}},{key:"_attachLoginFormListener",value:function(){var e=this,t=vt().showModalMessageBox,n=document.querySelector("#loginForm");n&&n.addEventListener("submit",(function(n){n.preventDefault();var r=document.querySelector("#email").value,o=document.querySelector("#password").value;e._loginHandler?e._loginHandler({email:r,password:o}):(console.error("Login handler not set"),t("Login Error","Terjadi kesalahan saat login. Silakan coba lagi."))}))}},{key:"setLoginHandler",value:function(e){this._loginHandler=e}},{key:"showLoading",value:function(){var e=document.querySelector("#loginButton");e&&(e.textContent="Loading...",e.disabled=!0)}},{key:"hideLoading",value:function(){var e=document.querySelector("#loginButton");e&&(e.textContent="Login",e.disabled=!1)}},{key:"showError",value:function(e){(0,vt().showModalMessageBox)("Login Gagal","Login gagal: ".concat(e.message))}},{key:"redirectToHome",value:function(){window.location.hash="#/"}}])&&pt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function yt(e){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yt(e)}function gt(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return bt(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(bt(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,bt(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,bt(f,"constructor",u),bt(u,"constructor",c),c.displayName="GeneratorFunction",bt(u,o,"GeneratorFunction"),bt(f),bt(f,o,"Generator"),bt(f,r,(function(){return this})),bt(f,"toString",(function(){return"[object Generator]"})),(gt=function(){return{w:a,m:d}})()}function bt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}bt=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){bt(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},bt(e,t,n,r)}function wt(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function kt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,St(r.key),r)}}function St(e){var t=function(e){if("object"!=yt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==yt(t)?t:t+""}const _t=function(){return e=function e(t){var n=t.view;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._view=n,this._apiSource=se},t=[{key:"registerUser",value:(n=gt().m((function e(t){var n;return gt().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,this._view.showLoading(),e.n=1,this._apiSource.register({name:t.name,email:t.email,password:t.password});case 1:e.v,this._view.redirectToLogin(),e.n=3;break;case 2:e.p=2,n=e.v,console.error("Error during registration:",n),this._view.showError("Pendaftaran gagal: ".concat(n.message||"Terjadi kesalahan tidak dikenal."));case 3:return e.p=3,this._view.hideLoading(),e.f(3);case 4:return e.a(2)}}),e,this,[[0,2,3,4]])})),r=function(){var e=this,t=arguments;return new Promise((function(r,o){var a=n.apply(e,t);function i(e){wt(a,r,o,i,s,"next",e)}function s(e){wt(a,r,o,i,s,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)})}],t&&kt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r}();function Et(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r=document.getElementById("custom-message-box");r?(r.textContent=e,r.className="message-box ".concat(t," show"),setTimeout((function(){r.classList.remove("show"),r.textContent=""}),n)):(console.warn("Custom message box element not found!"),console.log("[Message: ".concat(t,"] ").concat(e)))}function Mt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=document.getElementById("modal-message-box"),a=document.getElementById("modal-message-title"),i=document.getElementById("modal-message-text"),s=document.getElementById("modal-message-close"),c=document.getElementById("modal-message-confirm");o&&a&&i&&s&&c?(a.textContent=e,i.textContent=t,o.classList.add("show"),s.onclick=null,c.onclick=null,r?(c.style.display="inline-block",s.textContent="Batal",c.onclick=function(){o.classList.remove("show"),n&&"function"==typeof n&&n(!0)},s.onclick=function(){o.classList.remove("show"),n&&"function"==typeof n&&n(!1)}):(c.style.display="none",s.textContent="OK",s.onclick=function(){o.classList.remove("show"),n&&"function"==typeof n&&n()})):(console.warn("One or more modal message box elements not found!"),alert("[Modal: ".concat(e,"] ").concat(t)),n&&"function"==typeof n&&n())}function Pt(){return{showMessageBox:Et,showModalMessageBox:Mt}}function Ot(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Tt(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Tt(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Tt(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,Tt(f,"constructor",u),Tt(u,"constructor",c),c.displayName="GeneratorFunction",Tt(u,o,"GeneratorFunction"),Tt(f),Tt(f,o,"Generator"),Tt(f,r,(function(){return this})),Tt(f,"toString",(function(){return"[object Generator]"})),(Ot=function(){return{w:a,m:d}})()}function Tt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Tt=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){Tt(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},Tt(e,t,n,r)}function jt(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function xt(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){jt(a,r,o,i,s,"next",e)}function s(e){jt(a,r,o,i,s,"throw",e)}i(void 0)}))}}function Bt(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Lt(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Lt(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Lt(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,Lt(f,"constructor",u),Lt(u,"constructor",c),c.displayName="GeneratorFunction",Lt(u,o,"GeneratorFunction"),Lt(f),Lt(f,o,"Generator"),Lt(f,r,(function(){return this})),Lt(f,"toString",(function(){return"[object Generator]"})),(Bt=function(){return{w:a,m:d}})()}function Lt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Lt=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){Lt(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},Lt(e,t,n,r)}function It(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function At(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){It(a,r,o,i,s,"next",e)}function s(e){It(a,r,o,i,s,"throw",e)}i(void 0)}))}}var Gt={render:function(){return At(Bt().m((function e(){return Bt().w((function(e){for(;;)if(0===e.n)return e.a(2,'\n        <section class="content">\n          <h2 class="content__heading">Cerita Tersimpan Anda</h2>\n          <div class="loading-indicator" id="loading-saved-stories" style="display: none;">Memuat cerita tersimpan...</div>\n          <div class="error-container" id="error-saved-stories" style="display: none;"></div>\n          <div id="saved-stories-list" class="stories"></div>\n        </section>\n      ')}),e)})))()},afterRender:function(){return At(Bt().m((function e(){var t,n,r,o,a,s,c,u;return Bt().w((function(e){for(;;)switch(e.n){case 0:return t={showMessageBox:"function"==typeof window.showMessageBox?window.showMessageBox:function(e,t){return console.log("[Message: ".concat(t,"] ").concat(e))},showModalMessageBox:"function"==typeof window.showModalMessageBox?window.showModalMessageBox:function(e,t,n,r){console.log("[Modal: ".concat(e,"] ").concat(t)),n&&"function"==typeof n&&(r?n(confirm("".concat(e,": ").concat(t))):n())}},n=t.showMessageBox,r=t.showModalMessageBox,o=new X(se),a=document.querySelector("#loading-saved-stories"),s=document.querySelector("#error-saved-stories"),c=document.querySelector("#saved-stories-list"),u=function(){var e=At(Bt().m((function e(){var t,n;return Bt().w((function(e){for(;;)switch(e.n){case 0:return a.style.display="block",s.style.display="none",c.innerHTML="",e.p=1,e.n=2,o.getSavedStories();case 2:0===(t=e.v).length?c.innerHTML='<div class="empty-state">Anda belum menyimpan cerita apapun.</div>':t.forEach((function(e){c.innerHTML+=i(e)})),e.n=4;break;case 3:e.p=3,n=e.v,console.error("Error fetching saved stories:",n),s.innerHTML='<p class="error-message">Gagal memuat cerita tersimpan: '.concat(n.message||"Terjadi kesalahan.","</p>"),s.style.display="block",r("Error","Gagal memuat cerita tersimpan.");case 4:return e.p=4,a.style.display="none",e.f(4);case 5:return e.a(2)}}),e,null,[[1,3,4,5]])})));return function(){return e.apply(this,arguments)}}(),e.n=1,u();case 1:c.addEventListener("click",function(){var e=At(Bt().m((function e(t){var a,i,s;return Bt().w((function(e){for(;;)switch(e.n){case 0:if(console.log("Click event detected:",t.target),!(a=t.target.closest(".btn-delete"))){e.n=7;break}if(console.log("Delete button found:",a),i=a.dataset.id,console.log("Story ID to delete:",i),i){e.n=1;break}return console.error("Story ID is missing from delete button"),r("Error","ID cerita tidak ditemukan."),e.a(2);case 1:if(!confirm("Apakah Anda yakin ingin menghapus cerita ini dari daftar tersimpan?")){e.n=6;break}return e.p=2,console.log("Attempting to delete story with ID:",i),e.n=3,o.deleteSavedStory(i);case 3:return n("Cerita berhasil dihapus dari daftar tersimpan!","success"),e.n=4,u();case 4:e.n=6;break;case 5:e.p=5,s=e.v,console.error("Error deleting saved story:",s),r("Hapus Gagal","Gagal menghapus cerita: ".concat(s.message||"Terjadi kesalahan."));case 6:e.n=8;break;case 7:console.log("Delete button not found, clicked element:",t.target);case 8:return e.a(2)}}),e,null,[[2,5]])})));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}}),e)})))()}};const Dt={"/":ke,"/login":mt,"/home":ke,"/add":Fe,"/about":ze,"/detail/:id":ot,"/register":{render:function(){return xt(Ot().m((function e(){return Ot().w((function(e){for(;;)if(0===e.n)return e.a(2,'\n            <div class="register-container">\n                <h2 class="text-xl font-semibold mb-4 text-center text-gray-800">Daftar Akun Baru</h2>\n                <form id="registerForm">\n                    <div class="form-group">\n                        <label for="name">Nama</label>\n                        <input type="text" id="name" name="name" placeholder="Masukkan nama Anda" required>\n                    </div>\n                    <div class="form-group">\n                        <label for="email">Email</label>\n                        <input type="email" id="email" name="email" placeholder="Masukkan email Anda" required>\n                    </div>\n                    <div class="form-group">\n                        <label for="password">Password</label>\n                        <input type="password" id="password" name="password" placeholder="Masukkan password" required>\n                    </div>\n                    <button type="submit" class="register-button btn-primary">Daftar</button>\n                </form>\n                <p class="text-center mt-4 text-gray-600">Sudah punya akun? <a href="#/login" class="text-primary-600 hover:underline">Login di sini</a></p>\n            </div>\n        ')}),e)})))()},afterRender:function(){var e=this;return xt(Ot().m((function t(){var n,r,o,a;return Ot().w((function(t){for(;;)switch(t.n){case 0:n=document.querySelector("#registerForm"),r=new _t({view:e}),o=Pt(),a=o.showModalMessageBox,n&&n.addEventListener("submit",function(){var e=xt(Ot().m((function e(t){var n,o,i,s;return Ot().w((function(e){for(;;)switch(e.n){case 0:if(t.preventDefault(),n=document.querySelector("#name").value,o=document.querySelector("#email").value,i=document.querySelector("#password").value,n&&o&&i){e.n=1;break}return a("Error Pendaftaran","Semua kolom harus diisi!"),e.a(2);case 1:return e.p=1,e.n=2,r.registerUser({name:n,email:o,password:i});case 2:e.n=4;break;case 3:e.p=3,s=e.v,console.error("Register error:",s);case 4:return e.a(2)}}),e,null,[[1,3]])})));return function(t){return e.apply(this,arguments)}}());case 1:return t.a(2)}}),t)})))()},showLoading:function(){var e=document.querySelector(".register-button");e&&(e.textContent="Mendaftar...",e.disabled=!0)},hideLoading:function(){var e=document.querySelector(".register-button");e&&(e.textContent="Daftar",e.disabled=!1)},showError:function(e){(0,Pt().showModalMessageBox)("Error Pendaftaran",e)},redirectToLogin:function(){(0,Pt().showModalMessageBox)("Pendaftaran Berhasil","Akun Anda berhasil didaftarkan! Silakan login.",(function(){window.location.hash="#/login"}))}},"/saved":Gt};function Ct(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Ft(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Ft(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Ft(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,Ft(f,"constructor",u),Ft(u,"constructor",c),c.displayName="GeneratorFunction",Ft(u,o,"GeneratorFunction"),Ft(f),Ft(f,o,"Generator"),Ft(f,r,(function(){return this})),Ft(f,"toString",(function(){return"[object Generator]"})),(Ct=function(){return{w:a,m:d}})()}function Ft(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Ft=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){Ft(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},Ft(e,t,n,r)}function Rt(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}var Ht=function(){var e,t=(e=Ct().m((function e(t){var n,r;return Ct().w((function(e){for(;;)switch(e.n){case 0:if(!document.startViewTransition){e.n=5;break}return e.p=1,n=document.startViewTransition(t),e.n=2,n.finished;case 2:e.n=4;break;case 3:return e.p=3,r=e.v,console.error("View transition error:",r),e.n=4,t();case 4:e.n=6;break;case 5:return e.n=6,t();case 6:return e.a(2)}}),e,null,[[1,3]])})),function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){Rt(a,r,o,i,s,"next",e)}function s(e){Rt(a,r,o,i,s,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}();function Nt(e){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nt(e)}function Ut(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return zt(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(zt(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,zt(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,zt(f,"constructor",u),zt(u,"constructor",c),c.displayName="GeneratorFunction",zt(u,o,"GeneratorFunction"),zt(f),zt(f,o,"Generator"),zt(f,r,(function(){return this})),zt(f,"toString",(function(){return"[object Generator]"})),(Ut=function(){return{w:a,m:d}})()}function zt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}zt=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){zt(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},zt(e,t,n,r)}function qt(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Wt(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){qt(a,r,o,i,s,"next",e)}function s(e){qt(a,r,o,i,s,"throw",e)}i(void 0)}))}}function Zt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Jt(r.key),r)}}function Jt(e){var t=function(e){if("object"!=Nt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Nt(t)?t:t+""}function Kt(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Vt(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Vt(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Vt(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,Vt(f,"constructor",u),Vt(u,"constructor",c),c.displayName="GeneratorFunction",Vt(u,o,"GeneratorFunction"),Vt(f),Vt(f,o,"Generator"),Vt(f,r,(function(){return this})),Vt(f,"toString",(function(){return"[object Generator]"})),(Kt=function(){return{w:a,m:d}})()}function Vt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Vt=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){Vt(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},Vt(e,t,n,r)}function Yt(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Qt(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){Yt(a,r,o,i,s,"next",e)}function s(e){Yt(a,r,o,i,s,"throw",e)}i(void 0)}))}}function Xt(){return"serviceWorker"in navigator&&"PushManager"in window}function $t(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r}function en(){return tn.apply(this,arguments)}function tn(){return(tn=Qt(Kt().m((function e(){var t;return Kt().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,Notification.requestPermission();case 1:return t=e.v,e.a(2,t)}}),e)})))).apply(this,arguments)}function nn(){return rn.apply(this,arguments)}function rn(){return(rn=Qt(Kt().m((function e(){var t,n,r,o,a,i,s;return Kt().w((function(e){for(;;)switch(e.n){case 0:if(console.log("üîî Memulai proses subscribe push notification..."),Xt()){e.n=1;break}return console.log("‚ùå Push notification not supported."),alert("Browser Anda tidak mendukung notifikasi push."),e.a(2);case 1:return t=null,n=null,e.p=2,e.n=3,en();case 3:if("granted"===e.v){e.n=4;break}return alert("Izin notifikasi ditolak. Aktifkan izin notifikasi di pengaturan browser."),e.a(2);case 4:return e.n=5,navigator.serviceWorker.getRegistration();case 5:if(n=e.v){e.n=6;break}return console.error("‚ùå Service Worker belum terdaftar."),alert("Service Worker belum aktif. Coba refresh halaman."),e.a(2);case 6:return console.log("‚úÖ Service Worker ready:",n),e.n=7,n.pushManager.getSubscription();case 7:if(!e.v){e.n=8;break}return console.log("‚ÑπÔ∏è Already subscribed to push notifications"),alert("Notifikasi sudah aktif!"),e.a(2);case 8:return e.n=9,n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:$t("BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk")});case 9:return t=e.v,console.log("‚úÖ Push subscription created:",t),r=t.toJSON(),o={endpoint:r.endpoint,keys:{auth:r.keys.auth,p256dh:r.keys.p256dh}},console.log("üì§ Sending subscription to server:",o),e.n=10,se.subscribePushNotification(o);case 10:if((a=e.v).ok){e.n=11;break}throw new Error("Server error: ".concat(a.status," ").concat(a.statusText));case 11:console.log("‚úÖ Subscription sent to server successfully"),alert("Notifikasi berhasil diaktifkan!"),e.n=16;break;case 12:if(e.p=12,i=e.v,console.error("‚ùå Error during push notification subscription:",i),alert("Gagal mengaktifkan notifikasi. Pastikan Anda memberikan izin."+" Error: ".concat(i.message)),!t){e.n=16;break}return e.p=13,e.n=14,t.unsubscribe();case 14:console.log("üßπ Subscription cleaned up from client"),e.n=16;break;case 15:e.p=15,s=e.v,console.error("‚ùå Error cleaning up subscription:",s);case 16:return e.a(2)}}),e,null,[[13,15],[2,12]])})))).apply(this,arguments)}function on(){return an.apply(this,arguments)}function an(){return(an=Qt(Kt().m((function e(){var t,n,r;return Kt().w((function(e){for(;;)switch(e.n){case 0:if(console.log("üîï Memulai proses unsubscribe push notification..."),Xt()){e.n=1;break}return console.log("‚ùå Push notification not supported."),e.a(2);case 1:return e.p=1,e.n=2,navigator.serviceWorker.getRegistration();case 2:if(t=e.v){e.n=3;break}return console.error("‚ùå Service Worker belum terdaftar."),e.a(2);case 3:return e.n=4,t.pushManager.getSubscription();case 4:if(!(n=e.v)){e.n=7;break}return e.n=5,se.unsubscribePushNotification(n.endpoint);case 5:return e.n=6,n.unsubscribe();case 6:console.log("‚úÖ Unsubscribed from push notifications"),alert("Notifikasi berhasil dinonaktifkan."),e.n=8;break;case 7:alert("Anda belum berlangganan notifikasi.");case 8:e.n=10;break;case 9:e.p=9,r=e.v,console.error("‚ùå Error during push notification unsubscription:",r),alert("Gagal menonaktifkan notifikasi: "+r.message);case 10:return e.a(2)}}),e,null,[[1,9]])})))).apply(this,arguments)}function sn(){return cn.apply(this,arguments)}function cn(){return(cn=Qt(Kt().m((function e(){var t,n,r;return Kt().w((function(e){for(;;)switch(e.n){case 0:if(Xt()){e.n=1;break}return e.a(2,!1);case 1:return e.p=1,e.n=2,navigator.serviceWorker.getRegistration();case 2:if(t=e.v){e.n=3;break}return e.a(2,!1);case 3:return e.n=4,t.pushManager.getSubscription();case 4:return n=e.v,e.a(2,null!==n);case 5:return e.p=5,r=e.v,console.error("‚ùå Error checking subscription status:",r),e.a(2,!1)}}),e,null,[[1,5]])})))).apply(this,arguments)}function un(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return ln(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,d.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,h=a[2];n>3?(o=h===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,d.v=r,d.n=a[1]):p<h&&(o=n<3||a[0]>r||r>h)&&(a[4]=n,a[5]=r,d.n=h,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!f;){a||(s?s<3?(s>1&&(d.n=-1),p(s,c)):d.n=c:d.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(ln(t={},r,(function(){return this})),t),f=u.prototype=s.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,ln(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,ln(f,"constructor",u),ln(u,"constructor",c),c.displayName="GeneratorFunction",ln(u,o,"GeneratorFunction"),ln(f),ln(f,o,"Generator"),ln(f,r,(function(){return this})),ln(f,"toString",(function(){return"[object Generator]"})),(un=function(){return{w:a,m:d}})()}function ln(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ln=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){ln(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},ln(e,t,n,r)}function fn(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function dn(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){fn(a,r,o,i,s,"next",e)}function s(e){fn(a,r,o,i,s,"throw",e)}i(void 0)}))}}var pn=new(function(){return e=function e(t){var n=t.content;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._content=n,this._publicRoutes=["/login","/register","/about"]},t=[{key:"renderPage",value:(n=Wt(Ut().m((function e(){var t,n,r,o,a,i,s,c,u,l,f=this;return Ut().w((function(e){for(;;)switch(e.n){case 0:if(e.p=0,t=qe.parseActiveUrlWithCombiner(),n=qe.parseActiveUrlWithoutCombiner(),console.log("üêõ App renderPage:",{currentHash:window.location.hash,parsedUrl:t,urlWithId:n,rawId:n.id}),!(r=Dt[t])&&t.includes("/detail/")?r=Dt["/detail/:id"]:r||(r=Dt["/"]),r){e.n=1;break}return console.error("Page not found for URL:",t),this._content.innerHTML='<div class="error-page">Halaman tidak ditemukan</div>',e.a(2);case 1:e.p=1,t.includes("/detail/")?(a=n.id?n.id.trim():null,console.log("üîß App: Creating detail page with cleaned ID:",a),o="function"==typeof r?new r(a):r):o="function"==typeof r?new r:r,!o.render&&r.render&&(o=r),e.n=3;break;case 2:return e.p=2,c=e.v,console.error("Error creating page instance:",c),this._content.innerHTML='<div class="error-page">\n          <h2>Terjadi kesalahan pada aplikasi</h2>\n          <p>Tidak dapat membuat instance halaman: '.concat(c.message,'</p>\n          <button onclick="window.location.reload()">Coba Lagi</button>\n        </div>'),e.a(2);case 3:if("function"==typeof o.render){e.n=4;break}return console.error("Page does not have render function:",t),this._content.innerHTML='<div class="error-page">Halaman tidak valid</div>',e.a(2);case 4:if(console.log("Page found:",r.name||"unnamed"),i=localStorage.getItem("token"),s=this._publicRoutes.includes(t),console.log("Auth check:",{token:!!i,isPublicRoute:s}),i||s){e.n=5;break}return console.log("Redirecting to login page (not authenticated)"),window.location.hash="#/login",e.a(2);case 5:if(!i||"/login"!==t&&"/register"!==t){e.n=6;break}return console.log("Redirecting to home page (already authenticated)"),window.location.hash="#/",e.a(2);case 6:return e.p=6,e.n=7,Ht(Wt(Ut().m((function e(){var t;return Ut().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,console.log("Rendering page content..."),e.n=1,o.render();case 1:if(f._content.innerHTML=e.v,!o.afterRender){e.n=2;break}return console.log("Executing afterRender..."),e.n=2,o.afterRender();case 2:"function"==typeof window.initLogoutButton&&window.initLogoutButton(),f._content.focus(),console.log("Page rendered successfully"),e.n=4;break;case 3:e.p=3,t=e.v,console.error("Error rendering page:",t),f._content.innerHTML='<div class="error-page">\n              <h2>Terjadi kesalahan saat memuat halaman</h2>\n              <p>'.concat(t.message,'</p>\n              <button onclick="window.location.reload()">Coba Lagi</button>\n            </div>');case 4:return e.a(2)}}),e,null,[[0,3]])}))));case 7:e.n=9;break;case 8:e.p=8,u=e.v,console.error("Error in page rendering:",u),this._content.innerHTML='<div class="error-page">\n          <h2>Terjadi kesalahan pada halaman</h2>\n          <p>'.concat(u.message,'</p>\n          <button onclick="window.location.reload()">Coba Lagi</button>\n        </div>');case 9:e.n=11;break;case 10:e.p=10,l=e.v,console.error("Fatal error in app rendering:",l),this._content.innerHTML='<div class="error-page">\n        <h2>Terjadi kesalahan pada aplikasi</h2>\n        <p>'.concat(l.message,'</p>\n        <button onclick="window.location.reload()">Coba Lagi</button>\n      </div>');case 11:return e.a(2)}}),e,this,[[6,8],[1,2],[0,10]])}))),function(){return n.apply(this,arguments)})}],t&&Zt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}())({content:document.getElementById("mainContent")});function hn(){return vn.apply(this,arguments)}function vn(){return vn=dn(un().m((function e(){var t,n;return un().w((function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("enablePush")){e.n=1;break}return console.warn('Tombol "enablePush" tidak ditemukan di DOM.'),e.a(2);case 1:return n=function(){var e=dn(un().m((function e(){return un().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,sn();case 1:e.v?(t.textContent="üîï Disable Notifications",t.classList.remove("enable-push-btn"),t.classList.add("disable-push-btn")):(t.textContent="üîî Enable Notifications",t.classList.remove("disable-push-btn"),t.classList.add("enable-push-btn"));case 2:return e.a(2)}}),e)})));return function(){return e.apply(this,arguments)}}(),e.n=2,n();case 2:t.addEventListener("click",dn(un().m((function e(){var t;return un().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,sn();case 1:if(!e.v){e.n=3;break}return e.n=2,on();case 2:e.n=4;break;case 3:return e.n=4,nn();case 4:return e.n=5,n();case 5:e.n=7;break;case 6:e.p=6,t=e.v,console.error("Error handling notification button click:",t),alert("Terjadi kesalahan saat mengubah status notifikasi.");case 7:return e.a(2)}}),e,null,[[0,6]])})))),console.log("‚úÖ Push notification button setup complete.");case 3:return e.a(2)}}),e)}))),vn.apply(this,arguments)}window.addEventListener("DOMContentLoaded",dn(un().m((function e(){var t;return un().w((function(e){for(;;)switch(e.n){case 0:pn.renderPage(),(t=document.getElementById("logoutButton"))&&t.addEventListener("click",(function(e){e.preventDefault(),console.log("Logout diklik"),confirm("Yakin ingin logout?")&&(localStorage.removeItem("token"),alert("Berhasil logout!"),window.location.hash="#/login")})),hn();case 1:return e.a(2)}}),e)})))),window.addEventListener("hashchange",(function(){pn.renderPage()})),window.addEventListener("load",(function(){"serviceWorker"in navigator?navigator.serviceWorker.register("/service-worker.js").then((function(e){console.log("‚úÖ Service Worker berhasil didaftarkan:",e)})).catch((function(e){console.error("‚ùå Pendaftaran Service Worker gagal:",e)})):console.warn("Service Worker tidak didukung browser ini!")}))}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e].call(a.exports,a,a.exports,r),a.exports}r.m=t,e=[],r.O=(t,n,o,a)=>{if(!n){var i=1/0;for(l=0;l<e.length;l++){for(var[n,o,a]=e[l],s=!0,c=0;c<n.length;c++)(!1&a||i>=a)&&Object.keys(r.O).every((e=>r.O[e](n[c])))?n.splice(c--,1):(s=!1,a<i&&(i=a));if(s){e.splice(l--,1);var u=o();void 0!==u&&(t=u)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[n,o,a]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={524:0,589:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[i,s,c]=n,u=0;if(i.some((t=>0!==e[t]))){for(o in s)r.o(s,o)&&(r.m[o]=s[o]);if(c)var l=c(r)}for(t&&t(n);u<i.length;u++)a=i[u],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(l)},n=self.webpackChunkstory_app=self.webpackChunkstory_app||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=r.O(void 0,[328,589,172],(()=>r(238)));o=r.O(o)})();